<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ƒê·ªÄ THI TH·ª¨ S·ªê 4</title>
<script>
// C·∫§U H√åNH MATHJAX CHU·∫®N
window.MathJax={
  tex:{
    inlineMath:[['$','$'],['\\(','\\)']],
    displayMath:[['$$','$$'],['\\[','\\]']],
    processEscapes:true,
    tags:'ams',
    packages:{'[+]':['noerrors','noundefined']}
  },
  options:{ignoreHtmlClass:'tex2jax_ignore',processHtmlClass:'tex2jax_process'},
  startup:{typeset:false}
};
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"></script>
<style>
:root{--primary:#6f42c1;--success:#28a745;--danger:#dc3545;--bg:#f4f6f9}body{font-family:'Segoe UI',Tahoma,sans-serif;background-color:var(--bg);margin:0;padding:20px;display:flex;justify-content:center;min-height:100vh;user-select:none}
#login-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,#6f42c1 0%,#a06ee1 100%);display:flex;justify-content:center;align-items:center;z-index:9999}.login-box{background:white;padding:40px;border-radius:15px;box-shadow:0 10px 25px rgba(0,0,0,0.2);text-align:center;width:350px}.login-box input{width:100%;padding:12px;margin:15px 0;border:2px solid #ddd;border-radius:8px;font-size:16px;box-sizing:border-box}.login-btn{width:100%;padding:12px;background:#6f42c1;color:white;border:none;border-radius:8px;font-size:16px;font-weight:bold;cursor:pointer}
#loading-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(255,255,255,0.9);z-index:10000;justify-content:center;align-items:center;flex-direction:column;font-size:1.5em;color:#6f42c1}
.main-layout{display:flex;gap:20px;width:100%;max-width:1200px;align-items:flex-start}
.quiz-container{flex:3;background:#fff;padding:30px;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,0.05);min-height:400px}
.nav-container{flex:1;background:#fff;padding:20px;border-radius:12px;position:sticky;top:20px;max-height:90vh;overflow-y:auto}
.timer-box{font-size:2em;font-weight:bold;text-align:center;margin-bottom:20px;color:#dc3545;border:2px solid #dc3545;padding:10px;border-radius:10px;background:#fff5f5}
.q-btn{width:40px;height:40px;border:1px solid #ddd;border-radius:8px;background:#fff;cursor:pointer;font-weight:bold;display:flex;align-items:center;justify-content:center}.q-btn.answered{background-color:var(--primary);color:white}.q-btn.active{border:3px solid #ffc107;transform:scale(1.15)}.q-btn.correct{background-color:var(--success)!important;color:white}.q-btn.wrong{background-color:var(--danger)!important;color:white}
.question-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(40px,1fr));gap:10px}
.question-content{font-size:1.2em;margin-bottom:25px;line-height:1.6;overflow-x:auto}
.option-label{display:flex;padding:15px;border:2px solid #eee;border-radius:10px;cursor:pointer;margin-bottom:15px;align-items:center;transition:0.2s}.option-label:hover{background-color:#f8f9fa}.option-label.selected{border-color:var(--primary);background-color:#e7f3fe}.option-label.is-correct{background-color:#d4edda;border-color:var(--success)}.option-label.is-wrong{background-color:#f8d7da;border-color:var(--danger)}
.explanation-box{margin-top:20px;padding:20px;background:#e2e6ea;border-radius:8px;display:none;border-left:5px solid #6f42c1;overflow-x:auto}
.btn-action{width:100%;padding:15px;border:none;border-radius:8px;font-size:1.1em;cursor:pointer;font-weight:bold;margin-top:20px;color:white;background:#6f42c1}.btn-submit{background-color:var(--success)}
.toggle-container{margin-bottom:20px;border-bottom:1px solid #eee;padding-bottom:15px;display:flex;align-items:center;justify-content:space-between}.switch{position:relative;display:inline-block;width:50px;height:26px}.switch input{opacity:0;width:0;height:0}.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;transition:.4s;border-radius:34px}.slider:before{position:absolute;content:"";height:20px;width:20px;left:4px;bottom:3px;background-color:white;transition:.4s;border-radius:50%}input:checked+.slider{background-color:#6f42c1}input:checked+.slider:before{transform:translateX(24px)}
@media(max-width:768px){.main-layout{flex-direction:column-reverse}.nav-container{width:100%;position:static}}
</style>
</head>
<body>
<div id="loading-overlay"><div>‚è≥ ƒêang t·∫£i ƒë·ªÅ thi...</div></div>
<div id="login-screen"><div class="login-box"><h2>üîí C·∫ßn M·∫≠t Kh·∫©u</h2><p>ƒê·ªÄ THI TH·ª¨ S·ªê 4</p><input type="password" id="password-input" placeholder="Nh·∫≠p m·∫≠t kh·∫©u..." onkeypress="if(event.key==='Enter')checkLogin()"><button class="login-btn" onclick="checkLogin()">V√†o L√†m B√†i</button><div id="login-error" style="color:red;margin-top:10px;display:none">Sai m·∫≠t kh·∫©u!</div></div></div>
<div class="main-layout" id="main-app" style="display:none">
<div class="quiz-container" id="quiz-container-div"><div id="quiz-area"><div style="display:flex;justify-content:space-between;margin-bottom:15px"><span style="background:#6f42c1;color:white;padding:5px 15px;border-radius:20px" id="q-number">C√¢u 1</span></div><div id="q-content" class="question-content tex2jax_process"></div><div id="options-area" class="tex2jax_process"></div><div id="explanation" class="explanation-box tex2jax_process"><strong>üí° L·ªùi gi·∫£i:</strong> <div id="explain-text"></div></div><div style="display:flex;gap:10px;margin-top:20px"><button class="btn-action" style="background:#6c757d;margin-top:0" onclick="prevQuestion()">‚¨Ö Tr∆∞·ªõc</button><button class="btn-action" style="background:#6f42c1;margin-top:0" onclick="nextQuestion()">Sau ‚û°</button></div></div><div id="result-area" style="text-align:center;display:none"><h2>üéâ K·∫øt th√∫c b√†i thi!</h2><div style="font-size:4em;color:#6f42c1;font-weight:bold" id="final-score">0/0</div><button class="btn-action" onclick="reviewMode()">üîç Xem l·∫°i b√†i</button><button class="btn-action" style="background:#6c757d" onclick="location.reload()">üîÑ L√†m l·∫°i</button></div></div>
<div class="nav-container"><div id="timer" class="timer-box">00:00</div><div class="toggle-container"><label class="switch"><input type="checkbox" id="practice-mode" onchange="togglePracticeMode()"><span class="slider"></span></label><span style="font-weight:bold;color:#555">Ch·∫ø ƒë·ªô Luy·ªán t·∫≠p</span></div><h3 style="text-align:center;margin:0 0 10px 0">Danh s√°ch c√¢u</h3><div class="question-grid" id="nav-grid"></div><button id="btn-finish" class="btn-action btn-submit" onclick="finishQuiz()">N·ªôp b√†i</button></div></div>
<script>
const CONFIG={pass:"2808",time:60};
const ENCODED_DATA="XGJlZ2lue2V4fQpUw61uaCBnaeG7m2kgaOG6oW4gJFxkaXNwbGF5c3R5bGUgXGxpbV97eCBcdG8gMH0gXGRmcmFje1xsbigxICsgeCkgLSBcc2luIHh9e3heMn0kClxjaG9pY2UKeyQwJH0Ke1xUcnVlICQtXGRmcmFjezF9ezJ9JH0KeyQtXGRmcmFjezF9ezZ9JH0Ke0EsIEIsIEMgxJHhu4F1IHNhaX0KXGxvaWdpYWl7Cn0KXGVuZHtleH0KClxiZWdpbntleH0KVMOtbmggZ2nhu5tpIGjhuqFuICRcZGlzcGxheXN0eWxlIFxsaW1fe3ggXHRvIDB9IFxsZWZ0KFxkZnJhY3tlXnggLSAxfXt4fVxyaWdodClee1xmcmFjezF9e3h9fSQKXGNob2ljZQp7JGUkfQp7XFRydWUgJGVeezEvMn0kfQp7JDEkfQp7QSwgQiwgQyDEkeG7gXUgc2FpfQpcbG9pZ2lhaXsKfQpcZW5ke2V4fQoKXGJlZ2lue2V4fQpUw61uaCBnaeG7m2kgaOG6oW4gJFxkaXNwbGF5c3R5bGUgXGxpbV97eCBcdG8gMH0gXGRmcmFje1xzcXJ0ezEgKyB4ICsgeF4yfSAtIDEgLSBcZnJhY3t4fXsyfX17eF4yfSQKXGNob2ljZQp7JFxkZnJhY3sxfXs4fSR9CntcVHJ1ZSAkXGRmcmFjezN9ezh9JH0KeyRcZGZyYWN7MX17NH0kfQp7QSwgQiwgQyDEkeG7gXUgc2FpfQpcbG9pZ2lhaXt9ClxlbmR7ZXh9CgpcYmVnaW57ZXh9ClTDrW5oIGdp4bubaSBo4bqhbiAkXGRpc3BsYXlzdHlsZSBcbGltX3t4IFx0byAwfSBcZGZyYWN7XHRhbiB4IC0geCAtIFxmcmFje3heM317M319e3heNX0kClxjaG9pY2UKe1xUcnVlICRcZGZyYWN7Mn17MTV9JH0KeyRcZGZyYWN7MX17MTV9JH0KeyQwJH0Ke0EsIEIsIEMgxJHhu4F1IHNhaX0KXGxvaWdpYWl7fQpcZW5ke2V4fQoKXGJlZ2lue2V4fSUxNApUw61uaCBnaeG7m2kgaOG6oW4KJFxkaXNwbGF5c3R5bGUgXGxpbV97eCBcdG8gMH0gXGZyYWN7KDEreClee1xmcmFjezF9e3h9fSAtIGV9e3h9JC4KXGNob2ljZQp7JFxkZnJhY3tlfXsyfSR9CnskZSR9CnskMCR9CntcVHJ1ZSBBLCBCLCBDIMSR4buBdSBzYWl9Clxsb2lnaWFpeyRcZGlzcGxheXN0eWxlIFxsaW1fe3ggXHRvIDB9IFxmcmFjeygxK3gpXntcZnJhY3sxfXt4fX0gLSBlfXt4fT0tXGRmcmFje2V9ezJ9JH0KXGVuZHtleH0KClxiZWdpbntleH0KVMOtbmggZ2nhu5tpIGjhuqFuCiRcZGlzcGxheXN0eWxlIFxsaW1fe3ggXHRvIDB9IFxmcmFje1xsbigxK1x0YW4geCkgLSB4fXt4XjJ9JC4KXGNob2ljZQp7JFxkZnJhY3sxfXsyfSR9CnskMCR9CnskMSR9CntcVHJ1ZSBBLCBCLCBDIMSR4buBdSBzYWl9Clxsb2lnaWFpeyRcZGlzcGxheXN0eWxlIFxsaW1fe3ggXHRvIDB9IFxmcmFje1xsbigxK1x0YW4geCkgLSB4fXt4XjJ9ID0gLVxkZnJhY3sxfXsyfSR9ClxlbmR7ZXh9CgpcYmVnaW57ZXh9JTgKVMOtbmggZ2nhu5tpIGjhuqFuCiRcbGltX3t4IFx0byAwfSBcZnJhY3tlXnt4XjJ9IC0gXGNvcyB4fXt4XjJ9JC4KXGNob2ljZQp7MX0Ke1xUcnVlICRcZGZyYWN7M317Mn0kfQp7JFxkZnJhY3sxfXsyfSR9CntBLCBCLCBDIMSR4buBdSBzYWl9Clxsb2lnaWFpe30KXGVuZHtleH0KClxiZWdpbntleH0KQ2hvICRmKHgpID0gXGJlZ2lue2Nhc2VzfSAKXGRmcmFje2VeeCAtIDEgLSB4IC0gXGZyYWN7eF4yfXsyfX17eF4zfSwgJiB4IFxuZXEgMCBcXCAKYSwgJiB4ID0gMCBcZW5ke2Nhc2VzfSQuIArEkOG7gyAkZih4KSQgbGnDqm4gdOG7pWMgdOG6oWkgJHggPSAwJCB0aMOsOgpcY2hvaWNlCntcVHJ1ZSAkYSA9IFxkZnJhY3sxfXs2fSR9CnskYSA9IFxkZnJhY3sxfXszfSR9CnskYSA9IDAkfQp7QSwgQiwgQyDEkeG7gXUgc2FpfQpcbG9pZ2lhaXsKxJDhu4MgaMOgbSBz4buRICRmKHgpJCBsacOqbiB04bulYyB04bqhaSAkeCA9IDAkLCB0YSBwaOG6o2kgY8OzICRcZGlzcGxheXN0eWxlIFxsaW1fe3ggXHRvIDB9IGYoeCkgPSBmKDApID0gYSQuIFxcCkThu4UgZMOgbmcgdMOtbmggxJHGsOG7o2MgJFxkaXNwbGF5c3R5bGUgXGxpbV97eCBcdG8gMH0gXGRmcmFje2VeeCAtIDEgLSB4IC0gXGZyYWN7eF4yfXsyfX17eF4zfSA9IFxkZnJhY3sxfXs2fS4gJCBcXApW4bqteSwgxJHhu4MgJGYoeCkkIGxpw6puIHThu6VjIHThuqFpICR4ID0gMCQsIHRhIHBo4bqjaSBjw7MgJGEgPSBcZGZyYWN7MX17Nn0kLgp9ClxlbmR7ZXh9CgpcYmVnaW57ZXh9CktoYWkgdHJp4buDbiBNYWNsYXVyaW4gY+G7p2EgJGYoeCkgPSBcbG4oXGNvcyB4KSQgxJHhur9uIGLhuq1jIDQgbMOgOgpcY2hvaWNlCntcVHJ1ZSAkLVxkZnJhY3t4XjJ9ezJ9IC0gXGRmcmFje3heNH17MTJ9ICsgTyh4XjQpJH0KeyQtXGRmcmFje3heMn17Mn0gLSBcZGZyYWN7eF40fXsxMn0gKyBPKHheNikkfQp7JC1cZGZyYWN7eF4yfXsyfSArIFxkZnJhY3t4XjR9ezEyfSArIE8oeF40KSR9CntBLCBCLCBDIMSR4buBdSBzYWl9Clxsb2lnaWFpewpUYSBjw7Mga2hhaSB0cmnhu4NuIE1hY2xhdXJpbiBj4bunYSAkXGNvcyB4JDoKJFxjb3MgeCA9IDEgLSBcZGZyYWN7eF4yfXsyIX0gKyBcZGZyYWN7eF40fXs0IX0gKyBPKHheNCkgPSAxIC0gXGRmcmFje3heMn17Mn0gKyBcZGZyYWN7eF40fXsyNH0gKyBPKHheNCkkIFxcCsSQ4bq3dCAkdSA9IC1cZGZyYWN7eF4yfXsyfSArIFxkZnJhY3t4XjR9ezI0fSArIE8oeF40KSQuIEtoaSAkeCBcdG8gMCQgdGjDrCAkdSBcdG8gMCQuIFxcCktoYWkgdHJp4buDbiBNYWNsYXVyaW4gY+G7p2EgJFxsbigxK3UpJDoKJFxsbigxK3UpID0gdSAtIFxkZnJhY3t1XjJ9ezJ9ICsgTyh1XjIpJC4gXFwKVGhheSAkdSQgdsOgbyAkZih4KSA9IFxsbihcY29zIHgpID0gXGxuXGxlZnQoMSArIFxsZWZ0KC1cZGZyYWN7eF4yfXsyfSArIFxkZnJhY3t4XjR9ezI0fSArIE8oeF40KVxyaWdodClccmlnaHQpJDogClxiZWdpbnthbGlnbip9CmYoeCkgJiA9IFxsZWZ0KC1cZGZyYWN7eF4yfXsyfSArIFxkZnJhY3t4XjR9ezI0fVxyaWdodCkgLSBcZGZyYWN7MX17Mn1cbGVmdCgtXGRmcmFje3heMn17Mn0gKyBcZGZyYWN7eF40fXsyNH1ccmlnaHQpXjIgKyBPKHheNCkgXFwKZih4KSAmID0gLVxkZnJhY3t4XjJ9ezJ9ICsgXGRmcmFje3heNH17MjR9IC0gXGRmcmFjezF9ezJ9XGxlZnQoXGRmcmFje3heNH17NH0gLSBcZGZyYWN7eF42fXsyNH0gKyBcZGZyYWN7eF44fXs1NzZ9XHJpZ2h0KSArIE8oeF40KSBcXApmKHgpICYgPSAtXGRmcmFje3heMn17Mn0gKyBcZGZyYWN7eF40fXsyNH0gLSBcZGZyYWN7eF40fXs4fSArIE8oeF40KSBcXApmKHgpICYgPSAtXGRmcmFje3heMn17Mn0gLSBcZGZyYWN7MX17MTJ9eF40ICsgTyh4XjQpLiAKXGVuZHthbGlnbip9Cn0KXGVuZHtleH0KClxiZWdpbntleH0KS2hhaSB0cmnhu4NuIE1hY2xhdXJpbiBj4bunYSAkZih4KSA9IGVee1xzaW4geH0kIMSR4bq/biBi4bqtYyAzIGzDoDoKXGNob2ljZQp7JDEreCtcZGZyYWN7eF4yfXsyfStcZGZyYWN7eF4zfXs2fStPKHheMykkfQp7JDEreCtcZGZyYWN7eF4yfXsyfS1cZGZyYWN7eF4zfXs2fStPKHheMykkfQp7XFRydWUgJDEreCtcZGZyYWN7eF4yfXsyfStPKHheMykkfQp7QSwgQiwgQyDEkeG7gXUgc2FpfQpcbG9pZ2lhaXsKVGEgY8OzIGtoYWkgdHJp4buDbiBNYWNsYXVyaW4gY+G7p2EgMiBow6BtIGPGoSBi4bqjbjogCiQkXHNpbiB4ID0geCAtIFxkZnJhY3t4XjN9ezMhfSArIE8oeF4zKSA9IHggLSBcZGZyYWN7eF4zfXs2fSArIE8oeF4zKSQkIAokJGVedT0gMSt1K1xkZnJhY3t1XjJ9ezIhfSsgXGRmcmFje3VeM317MyF9ICsgbyh1XjMpJCQKVGhheSAkdSBcdG8gXHNpbiB4JCB0YSDEkcaw4bujYyAKXGJlZ2lue2FsaWduKn0KZV57XHNpbiB4fSAmID0gMStcc2luIHgrIFxkZnJhY3tcc2luXjJ4fXsyfSArIFxkZnJhY3tcc2luXjN4fXs2fSArIG8oeF4zKSBcXAomID0gMSsgeC1cZGZyYWN7eF4zfXs2fSsgXGRmcmFje3heMn17Mn0gK1xkZnJhY3t4XjN9ezZ9ICtvKHheMykgXFwKJiA9IDEreCsgXGRmcmFje3heMn17Mn0rbyh4XjMpClxlbmR7YWxpZ24qfQp9ClxlbmR7ZXh9CgpcYmVnaW57ZXh9CktoYWkgdHJp4buDbiBNYWNsYXVyaW4gY+G7p2EgJGYoeCkgPSBcZGZyYWN7XGxuXGxlZnQoMSt4XHJpZ2h0KX17eH0kIMSR4bq/biBi4bqtYyAyIGzDoApcY2hvaWNlCntcVHJ1ZSAkMSAtIFxkZnJhY3t4fXsyfSArIFxkZnJhY3t4XjJ9ezN9ICsgT1xsZWZ0KHheMlxyaWdodCkkfQp7JDEgLSBcZGZyYWN7eH17Mn0gKyBcZGZyYWN7eF4yfXszfSArIE9cbGVmdCh4XjNccmlnaHQpJH0KeyQxIC0gXGRmcmFje3h9ezJ9ICsgT1xsZWZ0KHheMlxyaWdodCkkfQp7QSwgQiwgQyDEkeG7gXUgc2FpfQpcbG9pZ2lhaXsKVGEgY8OzIGtoYWkgdHJp4buDbiBNYWNsYXVyaW4gY+G7p2EgJFxsblxsZWZ0KDEreFxyaWdodCkkIMSR4bq/biBi4bqtYyAzIGzDoDoKJFxsblxsZWZ0KDEreFxyaWdodCkgPSB4IC0gXGRmcmFje3heMn17Mn0gKyBcZGZyYWN7eF4zfXszfSArIE9cbGVmdCh4XjNccmlnaHQpJCBcXApLaGkgxJHDsywga2hhaSB0cmnhu4NuIE1hY2xhdXJpbiBj4bunYSAkZih4KSQgxJHhur9uIGLhuq1jIDIgbMOgOgokJGYoeCkgPSBcZGZyYWN7XGxuXGxlZnQoMSt4XHJpZ2h0KX17eH0gPSBcZGZyYWN7MX17eH0gXGxlZnQoIHggLSBcZGZyYWN7eF4yfXsyfSArIFxkZnJhY3t4XjN9ezN9ICsgT1xsZWZ0KHheM1xyaWdodCkgXHJpZ2h0KSA9IDEgLSBcZGZyYWN7eH17Mn0gKyBcZGZyYWN7eF4yfXszfSArIE9cbGVmdCh4XjJccmlnaHQpJCQKfQpcZW5ke2V4fQoKXGJlZ2lue2V4fQpLaGFpIHRyaeG7g24gTWFjbGF1cmluIGPhu6dhICRmKHgpID0gXHNxcnR7MSArIFxzaW4geH0kIMSR4bq/biBi4bqtYyAyIGzDoApcY2hvaWNlCntcVHJ1ZSAkMSArIFxkZnJhY3t4fXsyfSAtIFxkZnJhY3t4XjJ9ezh9ICsgTyh4XjIpJH0KeyQxICsgXGRmcmFje3h9ezJ9IC0gXGRmcmFje3heMn17OH0gKyBPKHheMykkfQp7JDEgKyBcZGZyYWN7eH17Mn0gKyBcZGZyYWN7eF4yfXs4fSArIE8oeF4yKSR9CntBLCBCLCBDIMSR4buBdSBzYWl9Clxsb2lnaWFpewpcYmVnaW57YWxpZ24qfQpmKHgpPVxzcXJ0ezErXHNpbiB4fSBcaW1wbGllcyBmKDApPVxzcXJ0ezErXHNpbiAwfT0xIFxcCmYnKHgpID0gXGRmcmFje1xjb3MgeH17MlxzcXJ0ezErXHNpbiB4fX0gXGltcGxpZXMgZicoMCkgPSBcZGZyYWN7MX17Mn0gXFwKZicnKDApID0gXGRmcmFjey0yXHNpbiB4IFxzcXJ0ezErXHNpbiB4fS0gXGNvcyB4IFxmcmFje1xjb3MgeH17XHNxcnR7MStcc2luIHh9fX17NCgxK1xzaW4geCl9ID0gXGRmcmFjey0yXHNpbiB4KDErXHNpbiB4KS1cY29zXjJ4fXs0KDErXHNpbiB4KV57My8yfX0gXGltcGxpZXMgZicnKDApPSAtXGRmcmFjezF9ezR9ClxlbmR7YWxpZ24qfQpDw7RuZyB0aOG7qWMga2hhaSB0cmnhu4NuIE1hY2xhdXJpbiAKXGJlZ2lue2FsaWduKn0KZih4KSA9ZigwKSArXGRmcmFje2YnKDApfXsxIX14ICtcZGZyYWN7ZicnKDApfXsyIX14XjIgKyBvKHheMikgPSAxK1xkZnJhY3sxfXsyfXgtXGRmcmFjezF9ezh9eF4yK28oeF4yKQpcZW5ke2FsaWduKn0KfQpcZW5ke2V4fQoKXGJlZ2lue2V4fQpU4buRaSDGsHUgaMOgbSAkZih4LCB5KSA9IHheMiB5JCB24bubaSDEkWnhu4F1IGtp4buHbiAkeF4yICsgeV4yID0gMSQuCkvhur90IGx14bqtbiDEkcO6bmcgbMOgClxjaG9pY2UKe1xUcnVlICRmJCBjw7MgR1RMTiB2w6AgR1ROTn0KeyRmJCBjaOG7iSBjw7MgR1RMTn0KeyRmJCBraMO0bmcgY8OzIGPhu7FjIHRy4buLfQp7QSwgQiwgQyDEkeG7gXUgc2FpfQpcbG9pZ2lhaQp7TeG7mXQgaMOgbSBz4buRIGxpw6puIHThu6VjIHRyw6puIG3hu5l0IHThuq1wIFx0ZXh0YmZ7xJHDs25nIHbDoCBi4buLIGNo4bq3bn0gdGjDrCBMVcOUTiBMVcOUTiDEkeG6oXQgxJHGsOG7o2MgR2nDoSB0cuG7iyBs4bubbiBuaOG6pXQgKEdUTE4pIHbDoCBHacOhIHRy4buLIG5o4buPIG5o4bqldCAoR1ROTikuIFxcIApU4burIGdp4bqjIHRoaeG6v3QgdGEgY8OzICR4XjI9MS15XjIkLiBLaGkgxJHDsyAkZj0oMS15XjIpeSA9IHkteV4zIFxpbXBsaWVzIGYnKHkpID0gMS0zeV4yJCBcXAokZicoeSk9MCBcaWZmIHk9XHBtIFxkZnJhY3sxfXtcc3FydHszfX0kLiBUw61uaCB0b8OhbiB2w6Agbmjhuq1uIHRo4bqleSBow6BtIHPhu5EgY8OzIGPhuqMgc+G7kSBs4bubbiBuaOG6pXQgKGTGsMahbmcpIHbDoCBz4buRIG5o4buPIG5o4bqldCAow6JtKS4KfQpcZW5ke2V4fQoKXGJlZ2lue2V4fQpYw6l0IGLDoGkgdG/DoW4gTGFncmFuZ2U6ICRmKHgsIHkpID0geF4yICsgeV4yJCwgJGcoeCwgeSkgPSB4XjIgKyB5XjIgLSAxJC4KS2jhurNuZyDEkeG7i25oIG7DoG8gc2F1IMSRw6J5IMSRw7puZwpcY2hvaWNlCntcVHJ1ZSBN4buNaSDEkWnhu4NtIHRo4buPYSDEkWnhu4F1IGtp4buHbiDEkeG7gXUgbMOgIMSRaeG7g20gY+G7sWMgdHLhu4t9CntN4buNaSDEkWnhu4NtIGThu6tuZyDEkeG7gXUgbMOgIMSRaeG7g20gY+G7sWMgdHLhu4t9CntLaMO0bmcgdOG7k24gdOG6oWkgxJFp4buDbSBk4burbmd9CntBLCBCLCBDIMSR4buBdSBzYWl9Clxsb2lnaWFpCntO4bq/dSDEkWnhu4NtICQoeCwgeSkkIHRo4buPYSBtw6NuIMSRaeG7gXUga2nhu4duLCB0YSBjw7MgdGjhu4MgdGhheSB0cuG7sWMgdGnhur9wICR4XjIgKyB5XjIgPSAxJCB2w6BvIGjDoG0gJGYkLiBLaGkgxJHDszoKJCRmKHgsIHkpID0gMSBccXVhZCAoXHRleHR7SOG6sW5nIHPhu5F9KSQkClbDrCBow6BtIHPhu5EgJGYkIG5o4bqtbiBnacOhIHRy4buLIGtow7RuZyDEkeG7lWkgYuG6sW5nIDEgdOG6oWkgYuG6pXQga+G7syDEkWnhu4NtIG7DoG8gbuG6sW0gdHLDqm4gxJHGsOG7nW5nIHRyw7JuIMSRaeG7gXUga2nhu4duLCBuw6puIG3hu41pIMSRaeG7g20gdHLDqm4gxJHGsOG7nW5nIHRyw7JuIG7DoHkgxJHhu4F1IHbhu6thIGzDoCDEkWnhu4NtIGPhu7FjIMSR4bqhaSwgduG7q2EgbMOgIMSRaeG7g20gY+G7sWMgdGnhu4N1ICh24bubaSBnacOhIHRy4buLIGPhu7FjIHRy4buLIGzDoCAxKS4gCn0KXGVuZHtleH0KClxiZWdpbntleH0KVMOsbSBj4buxYyB0cuG7iyBj4bunYSAkZih4LHkpID0geF4yICsgeV4yJCB24bubaSDEkWnhu4F1IGtp4buHbiAkeF4yICsgeHkgKyB5XjIgPSAzJApcY2hvaWNlCnskZl97XG1pbn0gPSAxLCBmX3tcbWF4fSA9IDMkfQp7JGZfe1xtaW59ID0gXGRmcmFjezN9ezJ9LCBmX3tcbWF4fSA9IDMkfQp7JGZfe1xtaW59ID0gMSwgZl97XG1heH0gPSA2JH0Ke1xUcnVlIEEsIEIsIEMgxJHhu4F1IHNhaX0KXGxvaWdpYWl7Clx0ZXh0YmZ7QzEufSDEkOG6t3QgJGYoeCx5KSA9IHheMit5XjIkLiDEkGnhu4F1IGtp4buHbiAkZyh4LHkpID0geF4yK3h5K3leMi0zPTAkLiBcXApT4butIGThu6VuZyBwaMawxqFuZyBwaMOhcCBuaMOibiB04butIExhZ3JhbmdlOiAkTCh4LHksXGxhbWJkYSkgPSB4XjIreV4yICsgXGxhbWJkYSh4XjIreHkreV4yLTMpJC4gXFwKQ8OhYyDEkeG6oW8gaMOgbSByacOqbmc6CiRcYmVnaW57Y2FzZXN9ClxkZnJhY3tccGFydGlhbCBMfXtccGFydGlhbCB4fSA9IDJ4ICsgXGxhbWJkYSgyeCt5KSA9IDAgXFwKXGRmcmFje1xwYXJ0aWFsIEx9e1xwYXJ0aWFsIHl9ID0gMnkgKyBcbGFtYmRhKHgrMnkpID0gMCBcXAp4XjIreHkreV4yPTMgXHF1YWQgKDMpClxlbmR7Y2FzZXN9IFxpZmYgeT0gXHBtIHgkLiBcXApcdGV4dGJme1RyxrDhu51uZyBo4bujcCAxOn0gJHk9eCQuClRoYXkgdsOgbyAoMykgdGEgxJHGsOG7o2MgICR4XjIreCh4KSt4XjI9MyBcaW1wbGllcyAzeF4yPTMgXGltcGxpZXMgeF4yPTEgXGltcGxpZXMgeD1ccG0gMSQuIFxcCk7hur91ICR4PTEsIHk9MSQsIHRow6wgJGYoMSwxKSA9IDFeMisxXjIgPSAyJC4gXFwKTuG6v3UgJHg9LTEsIHk9LTEkLCB0aMOsICRmKC0xLC0xKSA9ICgtMSleMisoLTEpXjIgPSAyJC4gXFwKXHRleHRiZntUcsaw4budbmcgaOG7o3AgMjp9ICR5PS14JC4KVGhheSB2w6BvICgzKTogJHheMit4KC14KSsoLXgpXjI9MyBcaW1wbGllcyB4XjI9MyBcaW1wbGllcyB4PVxwbSBcc3FydHszfSQuIFxcCk7hur91ICR4PVxzcXJ0ezN9LCB5PS1cc3FydHszfSQsIHRow6wgJGYoXHNxcnR7M30sLVxzcXJ0ezN9KSA9IChcc3FydHszfSleMisoLVxzcXJ0ezN9KV4yID0gNiQuIFxcCk7hur91ICR4PS1cc3FydHszfSwgeT1cc3FydHszfSQsIHRow6wgJGYoLVxzcXJ0ezN9LFxzcXJ0ezN9KSA9ICgtXHNxcnR7M30pXjIrKFxzcXJ0ezN9KV4yPSA2JC4gXFwgClbhuq15ICRmX3tcbWlufT0yJCB2w6AgJGZfe1xtYXh9PTYkLiBcXApcdGV4dGJme0MyLn0gVGEgY8OzICRmID0geF4yICsgeV4yJC4gVmnhur90IGzhuqFpIMSRaeG7gXUga2nhu4duOgokJHheMiArIHleMiArIHh5ID0gMyBcUmlnaHRhcnJvdyBmICsgeHkgPSAzIFxSaWdodGFycm93IHh5ID0gMyAtIGYkJApUYSBsdcO0biBjw7MgYuG6pXQgxJHhurNuZyB0aOG7qWMgcXVhbiB0cuG7jW5nOgokJC1cZnJhY3t4XjIreV4yfXsyfSBcbGUgeHkgXGxlIFxmcmFje3heMit5XjJ9ezJ9IFxpZmYgLVxmcmFje2Z9ezJ9IFxsZSB4eSBcbGUgXGZyYWN7Zn17Mn0kJFRoYXkgJHh5ID0gMyAtIGYkIHbDoG8gYuG6pXQgxJHhurNuZyB0aOG7qWMgdHLDqm46CiQkLVxmcmFje2Z9ezJ9IFxsZSAzIC0gZiBcbGUgXGZyYWN7Zn17Mn0gXGlmZiAyIFxsZSBmIFxsZSA2JCQKfQpcZW5ke2V4fQoKXGJlZ2lue2V4fQpU4buRaSDGsHUgaMOgbSAkZih4LHkpID0geHkkIHbhu5tpIMSRaeG7gXUga2nhu4duICR4XjIgKyA0eV4yID0gNCQuIEvhur90IGx14bqtbiDEkcO6bmcgbMOgOgpcY2hvaWNlCntcVHJ1ZSAkZl97XG1heH0gPSAxJH0KeyRmX3tcbWlufSA9IDEkfQp7JGZfe1xtYXh9ID0gXGRmcmFjezF9ezJ9JH0Ke0EsIEIsIEMgxJHhu4F1IHNhaX0KXGxvaWdpYWl7Clx0ZXh0YmZ7QzEgKExhZ3JhbmdlKS59IMSQaeG7gXUga2nhu4duICRnKHgseSkgPSB4XjIrNHleMi00PTAkLiAKU+G7rSBk4bulbmcgcGjGsMahbmcgcGjDoXAgbmjDom4gdOG7rSBMYWdyYW5nZTogJEwoeCx5LFxsYW1iZGEpID0geHkgKyBcbGFtYmRhKHheMis0eV4yLTQpJC4KVMOsbSDEkWnhu4NtIGThu6tuZyAKJFxiZWdpbntjYXNlc30KTCdfeD0geSsyXGxhbWJkYSB4ID0wIFxcIApMJ3kgPXgrOFxsYW1iZGEgeT0wIFxcIAp4XjIrNHleMj00ClxlbmR7Y2FzZXN9IFxpZmYgXGxhbWJkYT0gXHBtIFxkZnJhY3sxfXs0fSQgIFxcCsSQ4bq/biDEkcOieSBi4bqhbiDEkeG7jWMgdOG7sSBsw6BtIHRp4bq/cC4gXFwgClx0ZXh0YmZ7QzIufSDDgXAgZOG7pW5nIELEkFQgQU0gLSBHTSB0YSDEkcaw4bujYyAKXGJlZ2lue2FsaWduKn0KeF4yICsgNHleMiBcZ2UgMlxzcXJ0e3heMiBcY2RvdCA0eV4yfSA9IDJcc3FydHs0eF4yeV4yfSA9IDIgXGNkb3QgMnx4eXwgPSA0fHh5fCBcXCAKXGlmZiA0IFxnZSA0fHh5fCBcaWZmIHx4eXwgXGxlIDEKXGVuZHthbGlnbip9Cgp9ClxlbmR7ZXh9CgpcYmVnaW57ZXh9ClThu5FpIMawdSBow6BtICRmKHgseSkgPSB4KzJ5JCB24bubaSDEkWnhu4F1IGtp4buHbiAkeF4yIC0geV4yID0gMSQuIEvhur90IGx14bqtbiDEkcO6bmcgbMOgOgpcY2hvaWNlCnskZiQgY8OzIEdUTE59CnskZiQgY8OzIEdUTk59CntcVHJ1ZSAkZiQga2jDtG5nIGPDsyBj4buxYyB0cuG7i30Ke0EsIEIsIEMgxJHhu4F1IHNhaX0KXGxvaWdpYWl7CsSQaeG7gXUga2nhu4duICRnKHgseSkgPSB4XjIteV4yLTE9MCQuClPhu60gZOG7pW5nIHBoxrDGoW5nIHBow6FwIG5ow6JuIHThu60gTGFncmFuZ2U6ICQkTCh4LHksXGxhbWJkYSkgPSB4KzJ5ICsgXGxhbWJkYSh4XjIteV4yLTEpJCQKQ8OhYyDEkeG6oW8gaMOgbSByacOqbmc6CiQkXGJlZ2lue2Nhc2VzfQpMJ194ID0gMSArIDJcbGFtYmRhIHggPSAwIFxpbXBsaWVzIHggPSAtXGRmcmFjezF9ezJcbGFtYmRhfSBccXVhZCAoMSkgXFwKTCdfeSA9IDIgLSAyXGxhbWJkYSB5ID0gMCBcaW1wbGllcyB5ID0gXGRmcmFjezF9e1xsYW1iZGF9IFxxdWFkICgyKSBcXAp4XjIgLSB5XjIgPSAxIFxxdWFkICgzKQpcZW5ke2Nhc2VzfSQkClRoYXkgJHgkIHbDoCAkeSQgdsOgbyAoMyk6CiRcbGVmdCgtXGRmcmFjezF9ezJcbGFtYmRhfVxyaWdodCleMiAtIFxsZWZ0KFxkZnJhY3sxfXtcbGFtYmRhfVxyaWdodCleMiA9IDEgXGltcGxpZXMgXGxhbWJkYV4yID0gLVxkZnJhY3szfXs0fSBcaW1wbGllcyBmJCBraMO0bmcgY8OzIGPhu7FjIHRy4buLLiAKfQpcZW5ke2V4fQoKXGJlZ2lue2V4fQpYw6l0IGLDoGkgdG/DoW4gTGFncmFuZ2U6CiRmKHgsIHkpID0geF4yICsgeV4yJCwgJGcoeCwgeSkgPSB4XjIgLSB5XjIkLgpLaOG6s25nIMSR4buLbmggbsOgbyBzYXUgxJHDonkgxJHDum5nPwpcY2hvaWNlCntcVHJ1ZSBN4buNaSDEkWnhu4NtIGThu6tuZyDEkeG7gXUgbMOgIGPhu7FjIHRy4buLfQp7S2jDtG5nIGPDsyDEkWnhu4NtIGThu6tuZ30Ke0PDsyDEkWnhu4NtIGThu6tuZyBuaMawbmcga2jDtG5nIHBo4bqjaSBj4buxYyB0cuG7i30Ke0EsIEIsIEMgxJHhu4F1IHNhaX0KXGxvaWdpYWl7Clx0ZXh0YmZ7QzEufSAkJEwgPSB4XjIgKyB5XjIgKyBcbGFtYmRhKHheMiAtIHleMikkJAokJFxiZWdpbntjYXNlc30KTCdfeCA9IDJ4ICsgMlxsYW1iZGEgeCA9IDJ4KDErXGxhbWJkYSkgPSAwIFxxdWFkICgxKSBcXApMJ195ID0gMnkgLSAyXGxhbWJkYSB5ID0gMnkoMS1cbGFtYmRhKSA9IDAgXHF1YWQgKDIpIFxcCnheMiAtIHleMiA9IDAgXHF1YWQgKDMpClxlbmR7Y2FzZXN9JCQKVOG7qyAkKDEpIFxpbXBsaWVzIHggPSAwJCBob+G6t2MgJFxsYW1iZGEgPSAtMSQuIFxcClThu6sgJCgyKVxpbXBsaWVzIHkgPSAwJCBob+G6t2MgJFxsYW1iZGEgPSAxJC4gXFwKTuG6v3UgJFxsYW1iZGEgPSAtMSQ6IFRoYXkgdsOgbyAkKDIpIFxSaWdodGFycm93IDR5ID0gMCBcUmlnaHRhcnJvdyB5ID0gMCQuIFThu6sgJCgzKSBcUmlnaHRhcnJvdyB4ID0gMCQuIFxcCk7hur91ICRcbGFtYmRhID0gMSQ6IFRoYXkgdsOgbyAkKDEpIFxSaWdodGFycm93IDR4ID0gMCBcUmlnaHRhcnJvdyB4ID0gMCQuIFThu6sgJCgzKSBcUmlnaHRhcnJvdyB5ID0gMCQuIFxcCk7hur91ICR4ID0gMCQ6IFThu6sgJCgzKSBcUmlnaHRhcnJvdyB5ID0gMCQuIEjhu4cgcGjGsMahbmcgdHLDrG5oIGNo4buJIGPDsyBt4buZdCBuZ2hp4buHbSBkdXkgbmjhuqV0IGzDoCDEkWnhu4NtIGThu6tuZyAkTSgwLDApJC4gXFwKXHRleHRiZntDMi59ICRnKHgseSkgPSB4XjIgLSB5XjIgPSAwIFxpZmYgeF4yID0geV4yIFxpZmYgeSA9IHgkIGhv4bq3YyAkeSA9IC14JC4gXFwKJFxpbXBsaWVzJCBU4bqtcCBo4bujcCBjw6FjIMSRaeG7g20gdGjhu49hIG3Do24gxJFp4buBdSBraeG7h24gbMOgIGhhaSDEkcaw4budbmcgdGjhurNuZyBj4bqvdCBuaGF1IHThuqFpIGfhu5FjIHThu41hIMSR4buZICQoMCwwKSQuIFxcCiRmKHgseSkgPSB4XjIgKyB5XjIkIGNow61uaCBsw6AgYsOsbmggcGjGsMahbmcga2hv4bqjbmcgY8OhY2ggdOG7qyDEkWnhu4NtICQoeCx5KSQgdOG7m2kgZ+G7kWMgdOG7jWEgxJHhu5kuIFxcClRyw6puIGhhaSDEkcaw4budbmcgdGjhurNuZyDEkWkgcXVhIGfhu5FjIHThu41hIMSR4buZLCDEkWnhu4NtIG7hurFtIGfhuqduIGfhu5FjIHThu41hIMSR4buZIG5o4bqldCBjaMOtbmggbMOgIGfhu5FjIHThu41hIMSR4buZICQoMCwwKSQuIFxcClThuqFpICQoMCwwKSQgdGjDrCAkZiA9IDAkLiBU4bqhaSBt4buNaSDEkWnhu4NtIGtow6FjIHRow6wgJGYgPiAwJC4gClbhuq15ICQoMCwwKSQgbMOgIMSRaeG7g20gQ+G7sWMgdGnhu4N1IHRvw6BuIGPhu6VjLiBE4bqrbiDEkeG6v24gxJFp4buDbSBk4burbmcgZHV5IG5o4bqldCBuw6B5IGNow61uaCBsw6AgY+G7sWMgdHLhu4suCn0KXGVuZHtleH0KCg==";
const LATEX_CONTENT = decodeURIComponent(escape(window.atob(ENCODED_DATA)));

let quizData=[],currentQIndex=0,userAnswers={},isReviewMode=false,isPracticeMode=false,timerInterval,timeRemaining=CONFIG.time*60;

// --- FORMAT TEXT N√ÇNG CAO (FIX ALIGN & MATRIX) ---
function formatText(str) {
    if (!str) return "";
    const mathBlocks = [];
    function pushBlock(text) { mathBlocks.push(text); return "%%%MATH_BLOCK_" + (mathBlocks.length - 1) + "%%%"; }
    
    // 1. B·∫£o v·ªá c√°c m√¥i tr∆∞·ªùng Math c∆° b·∫£n
    str = str.replace(/(\$\$[\s\S]*?\$\$)|(\$[\s\S]*?\$)|(\\\[[\s\S]*?\\\])/g, pushBlock);
    
    // 2. B·∫¢O V·ªÜ M√îI TR∆Ø·ªúNG LATEX (Smart Loop) - ƒê√¢y l√† ph·∫ßn FIX l·ªói align*
    let currentIndex = 0;
    while (true) {
        let startIdx = str.indexOf("\\begin{", currentIndex);
        if (startIdx === -1) break;
        let braceStart = startIdx + 7;
        let braceEnd = str.indexOf("}", braceStart);
        if (braceEnd === -1) break; 
        let envName = str.substring(braceStart, braceEnd);
        
        // Nh·ªØng m√¥i tr∆∞·ªùng N√ÄY l√† vƒÉn b·∫£n -> Kh√¥ng b·∫£o v·ªá, ƒë·ªÉ xu·ªëng d∆∞·ªõi x·ª≠ l√Ω
        if (["enumerate", "itemize", "multicols"].includes(envName)) { 
            currentIndex = braceEnd + 1; continue; 
        }

        // T√¨m tag ƒë√≥ng t∆∞∆°ng ·ª©ng
        let endTag = "\\end{" + envName + "}";
        let endIdx = str.indexOf(endTag, braceEnd);
        
        if (endIdx === -1) { currentIndex = braceEnd + 1; continue; }

        // C·∫Øt kh·ªëi n√†y ra v√† b·∫£o v·ªá (ƒë·ªÉ kh√¥ng b·ªã replace \ th√†nh <br>)
        let fullBlock = str.substring(startIdx, endIdx + endTag.length);
        let placeholder = pushBlock(fullBlock);
        str = str.substring(0, startIdx) + placeholder + str.substring(endIdx + endTag.length);
        currentIndex = startIdx + placeholder.length;
    }

    // 3. Format Text (Ch·ªâ ch·∫°y tr√™n vƒÉn b·∫£n ngo√†i Math)
    str = str.replace(/\\begin\{multicols\}\{(\d+)\}/g, "<div style='column-count: $1; column-gap: 40px;'>").replace(/\\end\{multicols\}/g, "</div>");
    str = str.replace(/\\begin\{enumerate\}(\[.*?\])?/g, "<ol style='padding-left:20px; margin: 5px 0'>").replace(/\\end\{enumerate\}/g, "</ol>");
    str = str.replace(/\\begin\{itemize\}/g, "<ul style='padding-left:20px; margin: 5px 0'>").replace(/\\end\{itemize\}/g, "</ul>");
    str = str.replace(/\\item\s*(\[.*?\])?/g, "<li>");
    
    // Chuy·ªÉn ƒë·ªïi xu·ªëng d√≤ng (Ch·ªâ t√°c ƒë·ªông text, v√¨ Math ƒë√£ b·ªã gi·∫•u)
    str = str.split("\\\\").join("<br>").split("\\newline").join("<br>");
    
    // Style
    str = str.replace(/\\textbf\{(.*?)\}/g, "<b>$1</b>").replace(/\\textit\{(.*?)\}/g, "<i>$1</i>").replace(/\\underline\{(.*?)\}/g, "<u>$1</u>");
    
    // 4. Tr·∫£ l·∫°i Math & Fix d·∫•u < >
    str = str.replace(/%%%MATH_BLOCK_(\d+)%%%/g, function(match, id) { 
        return mathBlocks[id].replace(/</g, "&lt;").replace(/>/g, "&gt;"); 
    });
    return str;
}

function extractBracedContent(text,startCommand){const startIndex=text.indexOf(startCommand);if(startIndex===-1)return{found:false,content:"",fullMatch:""};let openCount=0,contentStart=-1,foundStart=false;for(let i=startIndex;i<text.length;i++){if(text[i]==='{'){if(!foundStart){contentStart=i+1;foundStart=true}openCount++}else if(text[i]==='}'){openCount--;if(foundStart&&openCount===0)return{found:true,content:text.substring(contentStart,i),fullMatch:text.substring(startIndex,i+1)}}}return{found:false,content:"",fullMatch:""}}
function parseChoicesBlock(rawText){let choices=[],currentIndex=0;while(choices.length<4&&currentIndex<rawText.length){let openIndex=rawText.indexOf('{',currentIndex);if(openIndex===-1)break;let openCount=1,closeIndex=-1;for(let i=openIndex+1;i<rawText.length;i++){if(rawText[i]==='{')openCount++;else if(rawText[i]==='}')openCount--;if(openCount===0){closeIndex=i;break}}if(closeIndex!==-1){choices.push(rawText.substring(openIndex+1,closeIndex));currentIndex=closeIndex+1}else break}return choices}
function parseLatex(text){const questions=[],exBlocks=text.match(/\\begin\{ex\}([\s\S]*?)\\end\{ex\}/g);if(!exBlocks)return[];exBlocks.forEach(block=>{let content=block.replace(/\\begin\{ex\}|\\end\{ex\}/g,"").trim(),explain="";const loigiaiData=extractBracedContent(content,"\\loigiai");if(loigiaiData.found){explain=formatText(loigiaiData.content.trim());content=content.replace(loigiaiData.fullMatch,"")}const parts=content.split(/\\choice/);let questionText=formatText(parts[0].trim());if(parts.length<2)return;const rawChoices=parseChoicesBlock(parts[1]);if(rawChoices.length<4)return;let choices=[],correctChar='a';['a','b','c','d'].forEach((char,i)=>{let c=rawChoices[i].trim();if(c.includes("\\True")){correctChar=char;c=c.replace(/\\True/g,"").trim()}choices.push(formatText(c))});questions.push({q:questionText,a:choices[0],b:choices[1],c:choices[2],d:choices[3],correct:correctChar,explain:explain})});return questions}

function checkLogin(){ try { if(document.getElementById('password-input').value===CONFIG.pass){ document.getElementById('loading-overlay').style.display='flex'; setTimeout(() => { try { quizData=parseLatex(LATEX_CONTENT); if(quizData.length>0){ document.getElementById('login-screen').style.display='none'; document.getElementById('loading-overlay').style.display='none'; document.getElementById('main-app').style.display='flex'; initNavGrid(); loadQuestion(0); startTimer(); } else { throw new Error("Kh√¥ng t√¨m th·∫•y c√¢u h·ªèi"); } } catch(e) { document.getElementById('loading-overlay').style.display='none'; alert("L·ªói: "+e.message); } }, 500); } else { document.getElementById('login-error').style.display='block'; } } catch(e) { alert(e); } }
function startTimer(){updateTimerDisplay();timerInterval=setInterval(()=>{timeRemaining--;updateTimerDisplay();if(timeRemaining<=0){clearInterval(timerInterval);alert("H·∫øt gi·ªù!");finishQuiz(true)}},1000)}
function updateTimerDisplay(){const m=Math.floor(timeRemaining/60).toString().padStart(2,'0'),s=(timeRemaining%60).toString().padStart(2,'0');document.getElementById('timer').innerText=m+":"+s}
function initNavGrid(){const grid=document.getElementById('nav-grid');grid.innerHTML='';quizData.forEach((_,idx)=>{const btn=document.createElement('div');btn.className='q-btn';btn.innerText=idx+1;btn.id='nav-'+idx;btn.onclick=()=>loadQuestion(idx);grid.appendChild(btn)})}
function loadQuestion(index){currentQIndex=index;const data=quizData[index];document.querySelectorAll('.q-btn').forEach(b=>b.classList.remove('active'));document.getElementById('nav-'+index).classList.add('active');document.getElementById('q-number').innerText="C√¢u "+(index+1)+"/"+quizData.length;document.getElementById('q-content').innerHTML=data.q;const optionsArea=document.getElementById('options-area');optionsArea.innerHTML='';const userAnswer=userAnswers[index],showResultNow=isReviewMode||(isPracticeMode&&userAnswer);['a','b','c','d'].forEach(key=>{const label=document.createElement('label');label.className='option-label';if(showResultNow){label.style.pointerEvents='none';if(data.correct===key)label.classList.add('is-correct');if(userAnswer===key&&key!==data.correct)label.classList.add('is-wrong')}else{label.onclick=()=>selectOption(key)}if(!showResultNow&&userAnswer===key)label.classList.add('selected');label.innerHTML='<input type="radio" name="opt" '+(userAnswer===key?'checked':'')+'> <div style="width:100%">'+data[key]+'</div>';optionsArea.appendChild(label)});const explainBox=document.getElementById('explanation');if(showResultNow){document.getElementById('explain-text').innerHTML=data.explain||"Kh√¥ng c√≥ l·ªùi gi·∫£i.";explainBox.style.display='block'}else{explainBox.style.display='none'} if(window.MathJax)setTimeout(()=>MathJax.typesetPromise([document.getElementById('quiz-container-div')]),50);}
function selectOption(val){if(isReviewMode)return;userAnswers[currentQIndex]=val;document.getElementById('nav-'+currentQIndex).classList.add('answered');if(isPracticeMode)loadQuestion(currentQIndex);else{document.querySelectorAll('.option-label').forEach(l=>l.classList.remove('selected'));event.currentTarget.classList.add('selected');event.currentTarget.querySelector('input').checked=true}}
function togglePracticeMode(){isPracticeMode=document.getElementById('practice-mode').checked;loadQuestion(currentQIndex)}
function nextQuestion(){if(currentQIndex<quizData.length-1)loadQuestion(currentQIndex+1)}
function prevQuestion(){if(currentQIndex>0)loadQuestion(currentQIndex-1)}
function finishQuiz(force=false){if(!force&&!confirm("N·ªôp b√†i?"))return;clearInterval(timerInterval);isReviewMode=true;isPracticeMode=false;document.getElementById('practice-mode').disabled=true;let score=0;quizData.forEach((q,idx)=>{const btn=document.getElementById('nav-'+idx);btn.classList.remove('active');btn.classList.remove('answered');if(userAnswers[idx]===q.correct){score++;btn.classList.add('correct')}else{btn.classList.add('wrong')}});document.getElementById('quiz-area').style.display='none';document.getElementById('result-area').style.display='block';document.getElementById('btn-finish').style.display='none';document.getElementById('final-score').innerText=score+"/"+quizData.length}
function reviewMode(){document.getElementById('result-area').style.display='none';document.getElementById('quiz-area').style.display='block';loadQuestion(0)}
document.addEventListener('contextmenu',e=>e.preventDefault());document.onkeydown=function(e){if(e.keyCode==123||(e.ctrlKey&&e.shiftKey&&(e.keyCode=='I'.charCodeAt(0)||e.keyCode=='C'.charCodeAt(0)||e.keyCode=='J'.charCodeAt(0)))||(e.ctrlKey&&e.keyCode=='U'.charCodeAt(0)))return false};
</script>
</body>
</html>