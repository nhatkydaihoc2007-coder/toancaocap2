<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ƒê·ªÄ THI TH·ª¨ S·ªê 3</title>
<script>
// C·∫§U H√åNH MATHJAX CHU·∫®N
window.MathJax={
  tex:{
    inlineMath:[['$','$'],['\\(','\\)']],
    displayMath:[['$$','$$'],['\\[','\\]']],
    processEscapes:true,
    tags:'ams',
    packages:{'[+]':['noerrors','noundefined']}
  },
  options:{ignoreHtmlClass:'tex2jax_ignore',processHtmlClass:'tex2jax_process'},
  startup:{typeset:false}
};
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"></script>
<style>
:root{--primary:#6f42c1;--success:#28a745;--danger:#dc3545;--bg:#f4f6f9}body{font-family:'Segoe UI',Tahoma,sans-serif;background-color:var(--bg);margin:0;padding:20px;display:flex;justify-content:center;min-height:100vh;user-select:none}
#login-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,#6f42c1 0%,#a06ee1 100%);display:flex;justify-content:center;align-items:center;z-index:9999}.login-box{background:white;padding:40px;border-radius:15px;box-shadow:0 10px 25px rgba(0,0,0,0.2);text-align:center;width:350px}.login-box input{width:100%;padding:12px;margin:15px 0;border:2px solid #ddd;border-radius:8px;font-size:16px;box-sizing:border-box}.login-btn{width:100%;padding:12px;background:#6f42c1;color:white;border:none;border-radius:8px;font-size:16px;font-weight:bold;cursor:pointer}
#loading-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(255,255,255,0.9);z-index:10000;justify-content:center;align-items:center;flex-direction:column;font-size:1.5em;color:#6f42c1}
.main-layout{display:flex;gap:20px;width:100%;max-width:1200px;align-items:flex-start}
.quiz-container{flex:3;background:#fff;padding:30px;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,0.05);min-height:400px}
.nav-container{flex:1;background:#fff;padding:20px;border-radius:12px;position:sticky;top:20px;max-height:90vh;overflow-y:auto}
.timer-box{font-size:2em;font-weight:bold;text-align:center;margin-bottom:20px;color:#dc3545;border:2px solid #dc3545;padding:10px;border-radius:10px;background:#fff5f5}
.q-btn{width:40px;height:40px;border:1px solid #ddd;border-radius:8px;background:#fff;cursor:pointer;font-weight:bold;display:flex;align-items:center;justify-content:center}.q-btn.answered{background-color:var(--primary);color:white}.q-btn.active{border:3px solid #ffc107;transform:scale(1.15)}.q-btn.correct{background-color:var(--success)!important;color:white}.q-btn.wrong{background-color:var(--danger)!important;color:white}
.question-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(40px,1fr));gap:10px}
.question-content{font-size:1.2em;margin-bottom:25px;line-height:1.6;overflow-x:auto}
.option-label{display:flex;padding:15px;border:2px solid #eee;border-radius:10px;cursor:pointer;margin-bottom:15px;align-items:center;transition:0.2s}.option-label:hover{background-color:#f8f9fa}.option-label.selected{border-color:var(--primary);background-color:#e7f3fe}.option-label.is-correct{background-color:#d4edda;border-color:var(--success)}.option-label.is-wrong{background-color:#f8d7da;border-color:var(--danger)}
.explanation-box{margin-top:20px;padding:20px;background:#e2e6ea;border-radius:8px;display:none;border-left:5px solid #6f42c1;overflow-x:auto}
.btn-action{width:100%;padding:15px;border:none;border-radius:8px;font-size:1.1em;cursor:pointer;font-weight:bold;margin-top:20px;color:white;background:#6f42c1}.btn-submit{background-color:var(--success)}
.toggle-container{margin-bottom:20px;border-bottom:1px solid #eee;padding-bottom:15px;display:flex;align-items:center;justify-content:space-between}.switch{position:relative;display:inline-block;width:50px;height:26px}.switch input{opacity:0;width:0;height:0}.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;transition:.4s;border-radius:34px}.slider:before{position:absolute;content:"";height:20px;width:20px;left:4px;bottom:3px;background-color:white;transition:.4s;border-radius:50%}input:checked+.slider{background-color:#6f42c1}input:checked+.slider:before{transform:translateX(24px)}
@media(max-width:768px){.main-layout{flex-direction:column-reverse}.nav-container{width:100%;position:static}}
</style>
</head>
<body>
<div id="loading-overlay"><div>‚è≥ ƒêang t·∫£i ƒë·ªÅ thi...</div></div>
<div id="login-screen"><div class="login-box"><h2>üîí C·∫ßn M·∫≠t Kh·∫©u</h2><p>ƒê·ªÄ THI TH·ª¨ S·ªê 3</p><input type="password" id="password-input" placeholder="Nh·∫≠p m·∫≠t kh·∫©u..." onkeypress="if(event.key==='Enter')checkLogin()"><button class="login-btn" onclick="checkLogin()">V√†o L√†m B√†i</button><div id="login-error" style="color:red;margin-top:10px;display:none">Sai m·∫≠t kh·∫©u!</div></div></div>
<div class="main-layout" id="main-app" style="display:none">
<div class="quiz-container" id="quiz-container-div"><div id="quiz-area"><div style="display:flex;justify-content:space-between;margin-bottom:15px"><span style="background:#6f42c1;color:white;padding:5px 15px;border-radius:20px" id="q-number">C√¢u 1</span></div><div id="q-content" class="question-content tex2jax_process"></div><div id="options-area" class="tex2jax_process"></div><div id="explanation" class="explanation-box tex2jax_process"><strong>üí° L·ªùi gi·∫£i:</strong> <div id="explain-text"></div></div><div style="display:flex;gap:10px;margin-top:20px"><button class="btn-action" style="background:#6c757d;margin-top:0" onclick="prevQuestion()">‚¨Ö Tr∆∞·ªõc</button><button class="btn-action" style="background:#6f42c1;margin-top:0" onclick="nextQuestion()">Sau ‚û°</button></div></div><div id="result-area" style="text-align:center;display:none"><h2>üéâ K·∫øt th√∫c b√†i thi!</h2><div style="font-size:4em;color:#6f42c1;font-weight:bold" id="final-score">0/0</div><button class="btn-action" onclick="reviewMode()">üîç Xem l·∫°i b√†i</button><button class="btn-action" style="background:#6c757d" onclick="location.reload()">üîÑ L√†m l·∫°i</button></div></div>
<div class="nav-container"><div id="timer" class="timer-box">00:00</div><div class="toggle-container"><label class="switch"><input type="checkbox" id="practice-mode" onchange="togglePracticeMode()"><span class="slider"></span></label><span style="font-weight:bold;color:#555">Ch·∫ø ƒë·ªô Luy·ªán t·∫≠p</span></div><h3 style="text-align:center;margin:0 0 10px 0">Danh s√°ch c√¢u</h3><div class="question-grid" id="nav-grid"></div><button id="btn-finish" class="btn-action btn-submit" onclick="finishQuiz()">N·ªôp b√†i</button></div></div>
<script>
const CONFIG={pass:"2808",time:57};
const ENCODED_DATA="XGJlZ2lue2V4fQpUw61uaCBnaeG7m2kgaOG6oW4gJFxkaXNwbGF5c3R5bGUgXGxpbV97eCBcdG8gMH0gXGRmcmFje1xzcXJ0ezEreH0gLSBcc3FydFszXXsxK3h9fXt4fSQuClxjaG9pY2UKe1xUcnVlICRcZGZyYWN7MX17Nn0kfQp7JFxkZnJhY3sxfXszfSR9CnskXGRmcmFjezF9ezJ9JH0Ke0EsIEIsIEMgxJHhu4F1IHNhaX0KXGxvaWdpYWl7CsSQ4bq3dCAkXGRpc3BsYXlzdHlsZSBMID0gXGxpbV97eCBcdG8gMH0gXGRmcmFje1xzcXJ0ezEreH0gLSBcc3FydFszXXsxK3h9fXt4fSQuCsSQw6J5IGzDoCBk4bqhbmcgdsO0IMSR4buLbmggJFxkZnJhY3swfXswfSQuIFxcCsOBcCBk4bulbmcgcXV5IHThuq9jIEwnSG9waXRhbDoKXGJlZ2lue2FsaWduKn0KTCA9IFxsaW1fe3ggXHRvIDB9IFxkZnJhY3sgXGxlZnQoXHNxcnR7MSt4fSAtIFxzcXJ0WzNdezEreH1ccmlnaHQpJ317XGxlZnQoeFxyaWdodCknfSAKPSBcbGltX3t4IFx0byAwfSBcbGVmdCggXGRmcmFjezF9ezJcc3FydHsxK3h9fSAtIFxkZnJhY3sxfXszXHNxcnRbM117XGxlZnQoMSt4XHJpZ2h0KV4yfX0gXHJpZ2h0KSBcXAo9IFxkZnJhY3sxfXsyXHNxcnR7MSswfX0gLSBcZGZyYWN7MX17M1xzcXJ0WzNde1xsZWZ0KDErMFxyaWdodCleMn19ID0gXGRmcmFjezF9ezJ9IC0gXGRmcmFjezF9ezN9ID0gXGRmcmFjezF9ezZ9ClxlbmR7YWxpZ24qfQp9ClxlbmR7ZXh9CgpcYmVnaW57ZXh9ClTDrW5oIGdp4bubaSBo4bqhbiAkXGRpc3BsYXlzdHlsZSBcbGltX3t4IFx0byArXGluZnR5fSBcbGVmdCgxICsgXGRmcmFjezJ9e3h9XHJpZ2h0KV57XHNxcnR7eH19JApcY2hvaWNlCntcVHJ1ZSAxfQp7JGUkfQp7JCtcaW5mdHkkfQp7QSwgQiwgQyDEkeG7gXUgc2FpfQpcbG9pZ2lhaXsKxJDDonkgbMOgIGThuqFuZyB2w7QgxJHhu4tuaCAkMV5caW5mdHkkLiDDgXAgZOG7pW5nIGPDtG5nIHRo4bupYyAkXGRpc3BsYXlzdHlsZSBcbGltX3t4IFx0byBcaW5mdHl9IGYoeClee2coeCl9ID0gZV57XGxpbV97eCBcdG8gXGluZnR5fSAoZih4KS0xKWcoeCl9JCB0YSDEkcaw4bujYyAKXGJlZ2lue2FsaWduKn0KXGxpbV97eCBcdG8gK1xpbmZ0eX0gXGxlZnQoMSArIFxkZnJhY3syfXt4fVxyaWdodClee1xzcXJ0e3h9fSA9IGVee1xsaW1fe3ggXHRvIFxpbmZ0eX0gXGZyYWN7Mn17eH0gXGNkb3QgXHNxcnR7eH19ID0gZV57XGxpbV97eCBcdG8gXGluZnR5fSBcZnJhY3syfXtcc3FydHt4fX19ID0gZV4wPTEuClxlbmR7YWxpZ24qfQp9ClxlbmR7ZXh9CgpcYmVnaW57ZXh9CkNobyBow6BtIHPhu5EgJGYoeCkgPSBcYmVnaW57Y2FzZXN9IGF4XjIgKyBieCArIDEsICYgeCA8IDEgXFwgXGxuIHggKyAyLCAmIHggXGdlIDEgXGVuZHtjYXNlc30kLiBO4bq/dSBow6BtIHPhu5EgbGnDqm4gdOG7pWMgdsOgIGPDsyDEkeG6oW8gaMOgbSB04bqhaSAkeCA9IDEkIHRow6wgJGErYiQgYuG6sW5nClxjaG9pY2UKezB9CntcVHJ1ZSAxfQp7Mn0Ke0EsIEIsIEMgxJHhu4F1IHNhaX0KXGxvaWdpYWl7CsSQ4buDIGjDoG0gc+G7kSBsacOqbiB04bulYyB04bqhaSAkeD0xJCwgdGEgcGjhuqNpIGPDsyAKXGJlZ2lue2FsaWduKn0KJiBcbGltX3t4IFx0byAxXi19IGYoeCkgPSBcbGltX3t4IFx0byAxXit9IGYoeCkgPSBmKDEpIFxcIApcaWZmICYgXGxpbV97eCBcdG8gMV4tfSAoYXheMiArIGJ4ICsgMSkgPSBcbGltX3t4IFx0byAxXit9IChcbG4geCArIDIpID0gXGxuIDEgKyAyIFxcIApcaWZmICYgYStiKzE9IDIgXGlmZiBhK2I9MQpcZW5ke2FsaWduKn0KxJDhu4MgaMOgbSBz4buRIGPDsyDEkeG6oW8gaMOgbSB04bqhaSAkeD0xJCwgxJHhuqFvIGjDoG0gdHLDoWkgdsOgIMSR4bqhbyBow6BtIHBo4bqjaSB04bqhaSAkeD0xJCBwaOG6o2kgYuG6sW5nIG5oYXUuIFxcCiQkZicoeCkgPSBcYmVnaW57Y2FzZXN9IAoyYXggKyBiLCAmIHggPCAxIFxcIApcZGZyYWN7MX17eH0sICYgeCA+IDEgClxlbmR7Y2FzZXN9JCQKxJDhuqFvIGjDoG0gdHLDoWkgdOG6oWkgJHg9MSQ6ICRcZGlzcGxheXN0eWxlIGYnX3stfSgxKSA9IFxsaW1fe3ggXHRvIDFeLX0gKDJheCtiKSA9IDJhK2IkLiBcXArEkOG6oW8gaMOgbSBwaOG6o2kgdOG6oWkgJHg9MSQ6ICRcZGlzcGxheXN0eWxlIGYnX3srfSgxKSA9IFxsaW1fe3ggXHRvIDFeK30gXGRmcmFjezF9e3h9ID0gMSQuIFxcCsSQ4buDIGjDoG0gc+G7kSBjw7MgxJHhuqFvIGjDoG0gdOG6oWkgJHg9MSQsIHRhIGPhuqduICQyYStiID0gMSQuIFxcClRhIGPDsyBo4buHIHBoxrDGoW5nIHRyw6xuaDogJFxiZWdpbntjYXNlc30KYStiPTEgXFwKMmErYj0xClxlbmR7Y2FzZXN9IFxpZmYgXGJlZ2lue2Nhc2VzfQogICAgYT0wIFxcCiAgICBiPTEKXGVuZHtjYXNlc30kCkdpw6EgdHLhu4sgY+G7p2EgJGErYiA9IDEkLgp9ClxlbmR7ZXh9CgpcYmVnaW57ZXh9ClTDrG0gJGEkIMSR4buDIGjDoG0gc+G7kSAkZih4KSA9IFxiZWdpbntjYXNlc30gClxkZnJhY3tlXnggLSAxIC0geH17eF4yfSwgJiB4IFxuZSAwIFxcIAphLCAmIHggPSAwIApcZW5ke2Nhc2VzfSQgbGnDqm4gdOG7pWMgdOG6oWkgJHggPSAwJApcY2hvaWNlCntcVHJ1ZSAkYSA9IFxkZnJhY3sxfXsyfSR9CnskYSA9IDEkfQp7JGEgPSAwJH0Ke0EsIEIsIEMgxJHhu4F1IHNhaX0KXGxvaWdpYWl7CsSQ4buDIGjDoG0gc+G7kSBsacOqbiB04bulYyB04bqhaSAkeD0wJCwgdGEgcGjhuqNpIGPDsyAkXGRpc3BsYXlzdHlsZSBcbGltX3t4IFx0byAwfSBmKHgpID0gZigwKT1hJC4gXFwKVGEgY+G6p24gdMOtbmggZ2nhu5tpIGjhuqFuIApcYmVnaW57YWxpZ24qfQpcbGltX3t4IFx0byAwfSBcZGZyYWN7ZV54IC0gMSAtIHh9e3heMn0gPSBcbGltX3t4IFx0byAwfSBcZGZyYWN7XGxlZnQoZV54IC0gMSAtIHhccmlnaHQpJ317XGxlZnQoeF4yXHJpZ2h0KSd9ID0gXGxpbV97eCBcdG8gMH0gXGRmcmFje2VeeCAtIDF9ezJ4fSBcXAo9IFxsaW1fe3ggXHRvIDB9IFxkZnJhY3tcbGVmdChlXnggLSAxXHJpZ2h0KSd9e1xsZWZ0KDJ4XHJpZ2h0KSd9ID0gXGxpbV97eCBcdG8gMH0gXGRmcmFje2VeeH17Mn0gPSBcZGZyYWN7ZV4wfXsyfT1cZGZyYWN7MX17Mn0KXGVuZHthbGlnbip9Clbhuq15LCDEkeG7gyBow6BtIHPhu5EgbGnDqm4gdOG7pWMgdOG6oWkgJHg9MCQsIHRhIHBo4bqjaSBjw7MgJGEgPSBcZGZyYWN7MX17Mn0kLgp9ClxlbmR7ZXh9CgpcYmVnaW57ZXh9CkjDoG0gc+G7kSAkZih4KSA9IHx4fF4zJCBjw7MgJGYnKDApJCBsw6AKXGNob2ljZQp7XFRydWUgMH0KezF9CnstMX0Ke0tow7RuZyB04buTbiB04bqhaX0KXGxvaWdpYWl7ClRhIGPDsyAkZih4KSA9IHheMyQga2hpICR4IFxnZSAwJCB2w6AgJGYoeCkgPSAteF4zJCBraGkgJHggPCAwJC4gXFwKJFxpbXBsaWVzIGYnX3srfSAoMCkgPSAwJCBraGkgJHggXGdlIDAkIHbDoCAkZidfey19ICgwKT0wJCBraGkgJHg8MCQgXFwKJFxpbXBsaWVzIGYnKDApPTAkCn0KXGVuZHtleH0KClxiZWdpbntleH0KS2hhaSB0cmnhu4NuIE1hY2xhdXJpbiBj4bunYSBow6BtIHPhu5EgJGYoeCkgPSBcbG4oMSt4XjIpJCDEkeG6v24gYuG6rWMgNCBsw6AKXGNob2ljZQp7XFRydWUgJHheMiAtIFxkZnJhY3t4XjR9ezJ9ICsgTyh4XjQpJH0KeyR4XjIgLSBcZGZyYWN7eF40fXsyfSArIE8oeF42KSR9CnskeF4yICsgXGRmcmFje3heNH17Mn0gKyBPKHheNCkkfQp7QSwgIEIsIEMgxJHhu4F1IHNhaX0KXGxvaWdpYWl7ClPhu60gZOG7pW5nIGtoYWkgdHJp4buDbiBNYWNsYXVyaW4gY+G7p2EgJFxsbigxK3UpID0gdSAtIFxkZnJhY3t1XjJ9ezJ9ICsgbyh1XjIpJC4gXFwKVGhheSAkdSA9IHheMiQsIHRhIMSRxrDhu6NjICRmKHgpID0gXGxuKDEreF4yKSA9IHheMiAtIFxkZnJhY3tcbGVmdCh4XjJccmlnaHQpXjJ9ezJ9ICsgbyh4XjQpID0geF4yIC0gXGRmcmFje3heNH17Mn0gK28oeF40KSQuIAp9ClxlbmR7ZXh9CgpcYmVnaW57ZXh9CljDqXQgaMOgbSBz4buRICR5ID0gXGRmcmFje3heMn17eC0xfSQuIEto4bqzbmcgxJHhu4tuaCDEkcO6bmcgbMOgClxjaG9pY2UKe0jDoG0gc+G7kSB0xINuZyB0csOqbiBt4buXaSBraG/huqNuZyB4w6FjIMSR4buLbmh9CntIw6BtIHPhu5EgZ2nhuqNtIHRyw6puIG3hu5dpIGtob+G6o25nIHjDoWMgxJHhu4tuaH0Ke1xUcnVlIEjDoG0gc+G7kSBjw7MgaGFpIMSRaeG7g20gY+G7sWMgdHLhu4t9CntIw6BtIHPhu5Ega2jDtG5nIGPDsyBj4buxYyB0cuG7i30KXGxvaWdpYWl7ClThuq1wIHjDoWMgxJHhu4tuaCAkRCA9IFxtYXRoYmJ7Un0gXHNldG1pbnVzIFxsZWZ0XHsxXHJpZ2h0XH0kLiBcXArEkOG6oW8gaMOgbSAkeScgPSBcZGZyYWN7MnhcbGVmdCh4LTFccmlnaHQpIC0geF4yfXtcbGVmdCh4LTFccmlnaHQpXjJ9ID0gXGRmcmFjezJ4XjIgLSAyeCAtIHheMn17XGxlZnQoeC0xXHJpZ2h0KV4yfSA9IFxkZnJhY3t4XjIgLSAyeH17XGxlZnQoeC0xXHJpZ2h0KV4yfSA9IFxkZnJhY3t4XGxlZnQoeC0yXHJpZ2h0KX17XGxlZnQoeC0xXHJpZ2h0KV4yfSA9IDAgXExlZnRyaWdodGFycm93IHhcbGVmdCh4LTJccmlnaHQpID0gMCBcTGVmdHJpZ2h0YXJyb3cgeD0wJCBob+G6t2MgJHg9MiQuICBcXApE4buFIGtp4buDbSB0cmEgxJHGsOG7o2MgaMOgbSBz4buRIGPDsyBt4buZdCBj4buxYyDEkeG6oWkgdOG6oWkgJHg9MCQgdsOgIG3hu5l0IGPhu7FjIHRp4buDdSB04bqhaSAkeD0yJC4gVuG6rXkgaMOgbSBz4buRIGPDsyBoYWkgxJFp4buDbSBj4buxYyB0cuG7iwp9ClxlbmR7ZXh9CgpcYmVnaW57ZXh9ClTDrG0gZ2nDoSB0cuG7iyBs4bubbiBuaOG6pXQgY+G7p2EgJGYoeCkgPSB4XHNxcnR7NC14XjJ9JCB0csOqbiDEkW/huqFuICRcbGVmdFstMiwgMlxyaWdodF0kClxjaG9pY2UKe1xUcnVlIDJ9CnskXHNxcnR7Mn0kfQp7MX0Ke0EsIEIsIEMgxJHhu4F1IHNhaX0KXGxvaWdpYWl7CsSQ4bqhbyBow6BtICRmJyh4KSA9IFxzcXJ0ezQteF4yfSArIHggXGNkb3QgXGRmcmFjey0yeH17MlxzcXJ0ezQteF4yfX0gPSBcc3FydHs0LXheMn0gLSBcZGZyYWN7eF4yfXtcc3FydHs0LXheMn19ID0gXGRmcmFje1xsZWZ0KDQteF4yXHJpZ2h0KSAtIHheMn17XHNxcnR7NC14XjJ9fSA9IFxkZnJhY3s0LTJ4XjJ9e1xzcXJ0ezQteF4yfX0kLiBcXAokZicoeCkgPSAwIFxMZWZ0cmlnaHRhcnJvdyA0LTJ4XjIgPSAwIFxMZWZ0cmlnaHRhcnJvdyB4XjIgPSAyIFxMZWZ0cmlnaHRhcnJvdyB4ID0gXHBtIFxzcXJ0ezJ9JC4gXFwKQ8OhYyDEkWnhu4NtIGPhuqduIHjDqXQ6ICR4PS0yLCB4PS1cc3FydHsyfSwgeD1cc3FydHsyfSwgeD0yJC4gXFwKJGYoLTIpPTAkLCAkZigtXHNxcnR7Mn0pPS0yJCwgJGYoXHNxcnR7Mn0pID0yJCwgJGYoMikgPSAwJC4gXFwKR2nDoSB0cuG7iyBs4bubbiBuaOG6pXQgY+G7p2EgaMOgbSBz4buRIHRyw6puIMSRb+G6oW4gJFxsZWZ0Wy0yLCAyXHJpZ2h0XSQgbMOgICQyJAp9ClxlbmR7ZXh9CgpcYmVnaW57ZXh9CkjDoG0gY+G6p3UgJFAgPSAxMDAgLSBRXjIkIHbDoCBjaGkgcGjDrSAkQyhRKSA9IFFeMyAtIDZRXjIgKyAyMFEkLiBN4bupYyBz4bqjbiBsxrDhu6NuZyDEkeG7gyBs4bujaSBuaHXhuq1uIMSR4bqhdCBj4buxYyDEkeG6oWkgbMOgClxjaG9pY2UKeyRRPTIkfQp7JFE9NCR9CnskUT02JH0Ke1xUcnVlIEEsIEIsIEMgxJHhu4F1IHNhaX0KXGxvaWdpYWl7CkjDoG0gbOG7o2kgbmh14bqtbiAkXHBpKFEpID0gUFEgLSBDKFEpJAokPSBcbGVmdCgxMDAgLSBRXjJccmlnaHQpUSAtIFxsZWZ0KFFeMyAtIDZRXjIgKyAyMFFccmlnaHQpID0gLTJRXjMgKyA2UV4yICsgODBRJCBcXAokXHBpJyhRKSA9IC02UV4yICsgMTJRICsgODAgPSAwIFxpZmYgUSA9MStcZGZyYWN7XHNxcnR7MTI5fX17M30kCn0KXGVuZHtleH0KClxiZWdpbntleH0KR2nhuqMgc+G7rSBow6BtIGPhuqd1ICRRID0gMjAgLSAyUF4yJC4gS2hpICRQID0gMiQsIGjhu4cgc+G7kSBjbyBnacOjbiBj4bunYSBj4bqndSB0aGVvIGdpw6EgbMOgClxjaG9pY2UKeyQtMSR9CnskLTIkfQp7JC00JH0Ke1xUcnVlIEEsIEIsIEMgxJHhu4F1IHNhaX0KXGxvaWdpYWl7CsSQ4bqhbyBow6BtIGPhu6dhICRRJCB0aGVvICRQJCBsw6AgJFxkZnJhY3tkUX17ZFB9ID0gLTRQJC4KS2hpICRQID0gMiQgdGjDrCAkUSA9IDEyJC4gXFwKSOG7hyBz4buRIGNvIGdpw6NuIGPhu6dhIGPhuqd1IHRoZW8gZ2nDoSDEkcaw4bujYyB0w61uaCBi4bqxbmcgY8O0bmcgdGjhu6ljICRFX2QgPSBcZGZyYWN7ZFF9e2RQfSBcY2RvdCBcZGZyYWN7UH17UX09ICgtOCkgXGNkb3QgXGRmcmFjezJ9ezEyfSA9IC1cZGZyYWN7NH17M30kLgp9ClxlbmR7ZXh9CgpcYmVnaW57ZXh9CljDqXQgdMOtY2ggcGjDom4gc3V5IHLhu5luZyAkXGRpc3BsYXlzdHlsZSBcaW50X3sxfV57K1xpbmZ0eX0gXGRmcmFje1xsbiB4fXt4XnB9ZHgkLiBUw61jaCBwaMOibiBo4buZaSB04bulIGtoaQpcY2hvaWNlCntcVHJ1ZSAkcCA+IDEkfQp7JHAgXGdlIDEkfQp7JHAgPiAyJH0Ke0EsIEIsIEMgxJHhu4F1IHNhaX0KXGxvaWdpYWl7CljDqXQgdMOtY2ggcGjDom4gc3V5IHLhu5luZyAkSSA9IFxkaXNwbGF5c3R5bGUgXGludF97MX1eeytcaW5mdHl9IFxkZnJhY3tcbG4geH17eF5wfWR4JC4gXFwKXHRleHRiZntDMSAoVMOtbmggdHLhu7FjIHRp4bq/cCkufSDEkOG6t3QgJFxiZWdpbntjYXNlc30KdT0gXGxuIHggXFwgCmR2PXheey1wfWR4ClxlbmR7Y2FzZXN9IFxpbXBsaWVzIFxiZWdpbntjYXNlc30KICAgIGR1ID0gXGRmcmFjezF9e3h9ZHggXFwgCiAgICB2PSBcZGZyYWN7eF57LXArMX19ey1wKzF9IH4gKHAgXG5lIDEpClxlbmR7Y2FzZXN9JCBcXApUaGVvIGPDtG5nIHRo4bupYyB0w61jaCBwaMOibiB04burbmcgcGjhuqduOgokJEkgPSBcbGVmdCggXGZyYWN7eF57MS1wfX17MS1wfVxsbiB4IFxyaWdodCkgXEJpZ3xfMV57K1xpbmZ0eX0gLSBcaW50X3sxfV57K1xpbmZ0eX0gXGZyYWN7eF57MS1wfX17MS1wfSBcY2RvdCBcZnJhY3sxfXt4fSBkeCQkCiQkSSA9IFxsZWZ0LiBcZnJhY3tcbG4geH17KDEtcCl4XntwLTF9fSBccmlnaHR8XzFeeytcaW5mdHl9IC0gXGZyYWN7MX17MS1wfSBcaW50X3sxfV57K1xpbmZ0eX0gXGZyYWN7MX17eF5wfSBkeCQkIAokXGRpc3BsYXlzdHlsZSBcaW50X3sxfV57K1xpbmZ0eX0gXGZyYWN7MX17eF5wfSBkeCQ6IFTDrWNoIHBow6JuIG7DoHkgY2jhu4kgaOG7mWkgdOG7pSBraGkgc+G7kSBtxakgJHAgPiAxJC4gXFwKWMOpdCBnaeG7m2kgaOG6oW4gJFxkaXNwbGF5c3R5bGUgXGxpbV97eCBcdG8gK1xpbmZ0eX0gXGZyYWN7XGxuIHh9eygxLXApeF57cC0xfX0kOiBcXApO4bq/dSAkcD4xJCB0aMOsIGThu4UgdGjhuqV5IGdp4bubaSBo4bqhbiBo4buZaSB04bulLiBO4bq/dSAkcCA8IDEgXGltcGxpZXMgcC0xIDwgMCQ6ICR4XntwLTF9JCBz4bq9IGNodXnhu4NuIGzDqm4gdOG7rSBz4buRLCBnaeG7m2kgaOG6oW4gcmEgJFxpbmZ0eSQuIFxcCktoaSAkcD0xJCB0aMOsICRcZGlzcGxheXN0eWxlIEkgPSBcaW50XzFeeytcaW5mdHl9IFxkZnJhY3tcbG4geH17eH1keCA9IFxpbnRfMV57K1xpbmZ0eX0gXGxuIHggZChcbG4geCkgPSBcZGZyYWN7XGxuIF4yeH17Mn0gXEJpZ3xfMF57K1xpbmZ0eX0gPSArXGluZnR5LiQgXFwKXHRleHRiZntDMi59IFRhIHNvIHPDoW5oIHbhu5tpIGjDoG0gJGcoeCkgPSBcZGZyYWN7MX17eF5cYWxwaGF9JC5cXApIw6BtICRcbG4geCQgdMSDbmcgY2jhuq1tIGjGoW4gbeG7jWkgbMWpeSB0aOG7q2EgJHheXGVwc2lsb24kICgkXGVwc2lsb24gPiAwJCkuIERvIMSRw7MsIHPhu7EgaOG7mWkgdOG7pSBj4bunYSAkXGRmcmFje1xsbiB4fXt4XnB9JCBcdGV4dGl0eyJn4bqnbiBnaeG7kW5nIn0gduG7m2kgc+G7sSBo4buZaSB04bulIGPhu6dhICRcZGZyYWN7MX17eF5wfSQuIFxcClR1eSBuaGnDqm4sIHbDrCAkXGxuIHgkIOG7nyB0csOqbiB04butIGzDoG0gaMOgbSBz4buRIGzhu5tuIGjGoW4gbeG7mXQgY2jDunQsIG7Dqm4gdGEgY+G6p24gJHAkIFx0ZXh0aXR7ImTGsCBz4bupYyJ9IGzhu5tuIGjGoW4gMS4KfQpcZW5ke2V4fQoKXGJlZ2lue2V4fQpHacOhIHRy4buLIGPhu6dhIHTDrWNoIHBow6JuICRcZGlzcGxheXN0eWxlIFxpbnRfezB9XnsrXGluZnR5fSB4XjIgZV57LXh9ZHgkIGzDoApcY2hvaWNlCntcVHJ1ZSAkMiR9CnskNCR9CnskNiR9CntBLCBCLCBDIMSR4buBdSBzYWl9Clxsb2lnaWFpewrEkOG6t3QgJEkgPSBcZGlzcGxheXN0eWxlIFxpbnRfezB9XnsrXGluZnR5fSB4XjIgZV57LXh9ZHgkLiBcXApcdGV4dGJme0zhuqduIDE6fSAKxJDhurd0ICRcYmVnaW57Y2FzZXN9CnUgPSB4XjIgXFwKZHYgPSBlXnsteH1keApcZW5ke2Nhc2VzfSBcUmlnaHRhcnJvdyBcYmVnaW57Y2FzZXN9CmR1ID0gMnggZHggXFwKdiA9IC1lXnsteH0KXGVuZHtjYXNlc30kIFxcCiRJID0gXGxlZnQoIC14XjIgZV57LXh9IFxyaWdodCkgXEJpZ3xfezB9XnsrXGluZnR5fSAtIFxkaXNwbGF5c3R5bGUgXGludF97MH1eeytcaW5mdHl9IFxsZWZ0KC1lXnsteH1ccmlnaHQpIDJ4IGR4ID0gXGxlZnQoIFxsaW1fe2IgXHRvICtcaW5mdHl9IFxsZWZ0KC1iXjIgZV57LWJ9XHJpZ2h0KSAtIFxsZWZ0KC0wXjIgZV57LTB9XHJpZ2h0KSBccmlnaHQpICsgMiBcZGlzcGxheXN0eWxlIFxpbnRfezB9XnsrXGluZnR5fSB4IGVeey14fWR4JCBcXApWw6wgJFxsaW1fe2IgXHRvICtcaW5mdHl9IGJeMiBlXnstYn0gPSAwJCwgbsOqbiAKJEkgPSAyIFxkaXNwbGF5c3R5bGUgXGludF97MH1eeytcaW5mdHl9IHggZV57LXh9ZHgkLiBcXApcdGV4dGJme0zhuqduIDJ9OgrEkOG6t3QgJEogPSBcZGlzcGxheXN0eWxlIFxpbnRfezB9XnsrXGluZnR5fSB4IGVeey14fWR4JC4gXFwKxJDhurd0ICRcYmVnaW57Y2FzZXN9CnU9eCAgXFwKZHYgPSBlXnsteH1keApcZW5ke2Nhc2VzfSBcaW1wbGllcyBcYmVnaW57Y2FzZXN9CiAgICBkdT1keCBcXAogICAgdiA9IC1lXnsteH0KXGVuZHtjYXNlc30kIFxcCiRKID0gXGxlZnQoIC14IGVeey14fSBccmlnaHQpIFxCaWd8XzAgXnsrXGluZnR5fSAtIFxkaXNwbGF5c3R5bGUgXGludF97MH1eeytcaW5mdHl9IFxsZWZ0KC1lXnsteH1ccmlnaHQpIGR4ID0gXGxlZnQoIFxsaW1fe2IgXHRvICtcaW5mdHl9IFxsZWZ0KC1iIGVeey1ifVxyaWdodCkgLSBcbGVmdCgtMCBlXnstMH1ccmlnaHQpIFxyaWdodCkgKyBcZGlzcGxheXN0eWxlIFxpbnRfezB9XnsrXGluZnR5fSBlXnsteH0gZHgkIFxcClbDrCAkXGRpc3BsYXlzdHlsZSBcbGltX3tiIFx0byArXGluZnR5fSBiIGVeey1ifSA9IDAkLCBuw6puIAokSiA9IFxkaXNwbGF5c3R5bGUgXGludF97MH1eeytcaW5mdHl9IGVeey14fSBkeCA9IFxsZWZ0KCAtZV57LXh9IFxyaWdodCkgXEJpZ3xfMF57K1xpbmZ0eX0gPSBcbGltX3tiIFx0byArXGluZnR5fSBcbGVmdCgtZV57LWJ9XHJpZ2h0KSAtIFxsZWZ0KC1lXnstMH1ccmlnaHQpID0gMCAtKC0xKSA9IDEkLiBcXApW4bqteSAkSSA9IDIgXGNkb3QgSiA9IDIgXGNkb3QgMSA9IDIkLiBcXApcdGV4dGl0eyhDw7MgdGjhu4MgZMO5bmcgTVRDVCBraeG7g20gdHJhIMSRw6FwIMOhbi4pfQp9ClxlbmR7ZXh9CgpcYmVnaW57ZXh9CkNobyAkZih4LCB5KSA9IHheMiB5ICsgZV57eHl9JC4gVMOtbmggJGRmKDAsMSkkClxjaG9pY2UKe1xUcnVlICRkeCR9CnskZHkkfQp7JGR4K2R5JH0Ke0EsIEIsIEMgxJHhu4F1IHNhaX0KXGxvaWdpYWl7ClRhIGPDsyAkZidfeCA9IFxkZnJhY3tccGFydGlhbCBmfXtccGFydGlhbCB4fSA9IDJ4eSArIHllXnt4eX0kIHbDoCAkZidfeSA9IFxkZnJhY3tccGFydGlhbCBmfXtccGFydGlhbCB5fSA9IHheMiArIHhlXnt4eX0kLiBcXApU4bqhaSDEkWnhu4NtICQoMCwxKSQ6CiRmJ194KDAsMSkgPSAxJCwgJGYnX3koMCwxKSA9IDAkLiBcXApWaSBwaMOibiB0b8OgbiBwaOG6p24gbMOgICRkZiA9IGYnX3ggZHggKyBmJ195IGR5JC4KVuG6rXkgJGRmKDAsMSkgPSBkeCArIDAgZHkgPSBkeCQuIFxcClx0ZXh0aXR7KEPDsyB0aOG7gyBkw7luZyBNVENUIGtp4buDbSB0cmEgxJHDoXAgw6FuLil9Cn0KXGVuZHtleH0KClxiZWdpbntleH0KSMOgbSBoYWkgYmnhur9uICR6ID0geF4yIHleMyQgdGjhu49hIG3Do24gaOG7hyB0aOG7qWMKXGNob2ljZQp7XFRydWUgJHh6X3ggKyB5el95ID0gNXokfQp7JHh6X3ggKyB5el95ID0gM3okfQp7JHh6X3ggKyB5el95ID0gMnokfQp7QSwgQiwgQyDEkeG7gXUgc2FpfQpcbG9pZ2lhaXsKVGEgY8OzIGPDoWMgxJHhuqFvIGjDoG0gcmnDqm5nOgokel94ID0gXGRmcmFje1xwYXJ0aWFsIHp9e1xwYXJ0aWFsIHh9ID0gMnh5XjMsIFxxdWFkIHpfeSA9IFxkZnJhY3tccGFydGlhbCB6fXtccGFydGlhbCB5fSA9IDN4XjIgeV4yJCBcXApUw61uaCBiaeG7g3UgdGjhu6ljICR4el94ICsgeXpfeSA9IDJ4XjIgeV4zICsgM3heMiB5XjMgPSA1eF4yIHleMz0gNXokLgp9ClxlbmR7ZXh9CgpcYmVnaW57ZXh9CkNobyAkdSA9IHheMiArIHh5ICsgeV4yJCwgduG7m2kgJHggPSBlXnMkLCAkeSA9IGVeey1zfSQuIFTDrW5oICRcZGZyYWN7ZHV9e2RzfSQKXGNob2ljZQp7XFRydWUgJDJcbGVmdChlXnsyc30gLSBlXnstMnN9XHJpZ2h0KSR9CnskZV57MnN9IC0gZV57LTJzfSR9CnskMlxsZWZ0KGVeezJzfSArIGVeey0yc31ccmlnaHQpJH0Ke0EsIEIsIEMgxJHhu4F1IHNhaX0KXGxvaWdpYWl7CsOBcCBk4bulbmcgcXV5IHThuq9jIMSR4bqhbyBow6BtIGjDoG0gaOG7o3A6ICRcZGZyYWN7ZHV9e2RzfSA9IFxkZnJhY3tccGFydGlhbCB1fXtccGFydGlhbCB4fSBcZGZyYWN7ZHh9e2RzfSArIFxkZnJhY3tccGFydGlhbCB1fXtccGFydGlhbCB5fSBcZGZyYWN7ZHl9e2RzfSQuIFxcClRhIGPDszoKJCRcZGZyYWN7XHBhcnRpYWwgdX17XHBhcnRpYWwgeH0gPSAyeCArIHk7IFxxdWFkIFxkZnJhY3tccGFydGlhbCB1fXtccGFydGlhbCB5fSA9IHggKyAyeSQkCiQkXGRmcmFje2R4fXtkc30gPSBlXnMsIFxxdWFkIFxkZnJhY3tkeX17ZHN9ID0gLWVeey1zfSQkClbhuq15OgokXGRmcmFje2R1fXtkc30gPSBcbGVmdCgyZV5zICsgZV57LXN9XHJpZ2h0KWVecyArIFxsZWZ0KGVecyArIDJlXnstc31ccmlnaHQpXGxlZnQoLWVeey1zfVxyaWdodCkgPSAyZV57MnN9ICsgZV4wIC0gZV4wIC0gMmVeey0yc30gPSAyZV57MnN9IC0gMmVeey0yc30gPSAyXGxlZnQoZV57MnN9IC0gZV57LTJzfVxyaWdodCkkLgp9ClxlbmR7ZXh9CgpcYmVnaW57ZXh9CsSQ4bqhbyBow6BtICR5JyQgY+G7p2EgaMOgbSDhuqluICR4XjIgKyB4eSArIHleMiA9IDMkIGzDoApcY2hvaWNlCntcVHJ1ZSAkeScgPSAtXGRmcmFjezJ4K3l9e3grMnl9JH0KeyR5JyA9IC1cZGZyYWN7eCsyeX17MngreX0kfQp7JHknID0gXGRmcmFjezJ4K3l9e3grMnl9JH0Ke0EsIEIsIEMgxJHhu4F1IHNhaX0KXGxvaWdpYWl7xJDhurd0ICRGKHgseSk9eF4yK3kreV4yLTM9MCQuIFxcCiR5JyA9IC1cZGZyYWN7RidfeH17RidfeX0gPSAtXGRmcmFjezJ4K3l9e3grMnl9JAp9ClxlbmR7ZXh9CgpcYmVnaW57ZXh9ClTDrG0gY+G7sWMgdHLhu4sgY+G7p2EgJGYoeCwgeSkgPSB4XjIgKyAyeV4yIC0gMnh5JApcY2hvaWNlCntcVHJ1ZSAkZiQgY8OzIGPhu7FjIHRp4buDdSB04bqhaSAkKDAsMCkkfQp7JGYkIGPDsyBj4buxYyDEkeG6oWkgdOG6oWkgJCgwLDApJH0KeyRmJCBraMO0bmcgY8OzIGPhu7FjIHRy4buLfQp7JGYkIGPDsyB5w6puIG5n4buxYSB04bqhaSAkKDAsMCkkfQpcbG9pZ2lhaXsKXHRleHRiZntDMX0uIETDuW5nIHBoxrDGoW5nIHBow6FwIG5ow6JuIHThu60gTGFyZ3JhbmdlLiBcXApcdGV4dGJme0MyLn0gQ8OzICRmID0geF4yLTJ4eSt5XjIreV4yPSAoeC15KV4yK3leMiBcZ2UgMCQuIEThuqV1ICI9IiB44bqjeSByYSAkXGlmZiB4PXk9MC4kCn0KXGVuZHtleH0KClxiZWdpbntleH0KVOG7kWkgxrB1ICRmKHgsIHkpID0gNXggKyAxMnkkIHbhu5tpIMSRaeG7gXUga2nhu4duICR4XjIgKyA0eV4yID0gMTAwJC4gxJBp4buDbSAkKDQsMykkIGzDoApcY2hvaWNlCnvEkGnhu4NtIGPhu7FjIMSR4bqhaX0Ke8SQaeG7g20gY+G7sWMgdGnhu4N1fQp7S2jDtG5nIHBo4bqjaSDEkWnhu4NtIGPhu7FjIHRy4buLfQp7XFRydWUgS2jDtG5nIHRo4buPYSDEkWnhu4F1IGtp4buHbn0KXGxvaWdpYWl7CsSQ4buDIGtp4buDbSB0cmEgxJFp4buDbSAkKDQsMykkLCB0YSB0aGF5IHbDoG8gxJFp4buBdSBraeG7h24gJHheMiArIDR5XjIgPSAxMDAkOiAKJDReMiArIDRcbGVmdCgzXjJccmlnaHQpID0gMTYgKyA0KDkpID0gMTYgKyAzNiA9IDUyJC4gClbDrCAkNTIgXG5lcSAxMDAkLCDEkWnhu4NtICQoNCwzKSQga2jDtG5nIHRo4buPYSBtw6NuIMSRaeG7gXUga2nhu4duIHLDoG5nIGJ14buZYy4gRG8gxJHDsywgbsOzIGtow7RuZyB0aOG7gyBsw6AgxJFp4buDbSBj4buxYyB0cuG7iyBjw7MgxJFp4buBdSBraeG7h24uIAp9ClxlbmR7ZXh9CgpcYmVnaW57ZXh9Ck3hu5l0IGRvYW5oIG5naGnhu4dwIHPhuqNuIHh14bqldCBoYWkgc+G6o24gcGjhuqltIHbhu5tpIGjDoG0gY2hpIHBow60gJFRDID0gUV8xXjMgKyBRXzJeMysgUV8xIFFfMiArIDIwJC4gR2nDoSBiw6FuIGzhuqduIGzGsOG7o3QgbMOgICRQXzEgPSA1MSwgUF8yID0gMzEkLiBN4bupYyBz4bqjbiBsxrDhu6NuZyB04buRaSDGsHUgbMOgClxjaG9pY2UKeyRRXzEgPSAzLCBRXzIgPSAyJH0Ke1xUcnVlICRRXzEgPSA0LCBRXzIgPSAzJH0KeyRRXzEgPSA1LCBRXzIgPSA0JH0Ke0EsIEIsIEMgxJHhu4F1IHNhaX0KXGxvaWdpYWl7CkjDoG0gbOG7o2kgbmh14bqtbiAkXHBpKFFfMSwgUV8yKSA9IFBfMSBRXzEgKyBQXzIgUV8yIC0gVEMgPSA1MVFfMSArIDMxUV8yIC0gUV8xXjMgLSBRXzJeMyAtIFFfMSBRXzIgLSAyMCQgXFwKJFxiZWdpbntjYXNlc30KXGRmcmFje1xwYXJ0aWFsIFxwaX17XHBhcnRpYWwgUV8xfSA9IDUxLSAzUV8xXjIgLSBRXzIgPSAwIFxcClxkZnJhY3tccGFydGlhbCBcUGl9e1xwYXJ0aWFsIFFfMn0gPSAzMSAtIDNRXzJeMiAtIFFfMSA9IDAgClxlbmR7Y2FzZXN9IFxpZmYgXGJlZ2lue2Nhc2VzfQozUV8xXjIgKyBRXzIgPSA1MSBcXAozUV8yXjIgKyBRXzEgPSAzMQpcZW5ke2Nhc2VzfSBcaWZmIFxiZWdpbntjYXNlc30KICAgIFFfMT00IFxcCiAgICBRXzI9MwpcZW5ke2Nhc2VzfSQgCgp9ClxlbmR7ZXh9Cgo=";
const LATEX_CONTENT = decodeURIComponent(escape(window.atob(ENCODED_DATA)));

let quizData=[],currentQIndex=0,userAnswers={},isReviewMode=false,isPracticeMode=false,timerInterval,timeRemaining=CONFIG.time*60;

// --- FORMAT TEXT N√ÇNG CAO (FIX ALIGN & MATRIX) ---
function formatText(str) {
    if (!str) return "";
    const mathBlocks = [];
    function pushBlock(text) { mathBlocks.push(text); return "%%%MATH_BLOCK_" + (mathBlocks.length - 1) + "%%%"; }
    
    // 1. B·∫£o v·ªá c√°c m√¥i tr∆∞·ªùng Math c∆° b·∫£n
    str = str.replace(/(\$\$[\s\S]*?\$\$)|(\$[\s\S]*?\$)|(\\\[[\s\S]*?\\\])/g, pushBlock);
    
    // 2. B·∫¢O V·ªÜ M√îI TR∆Ø·ªúNG LATEX (Smart Loop) - ƒê√¢y l√† ph·∫ßn FIX l·ªói align*
    let currentIndex = 0;
    while (true) {
        let startIdx = str.indexOf("\\begin{", currentIndex);
        if (startIdx === -1) break;
        let braceStart = startIdx + 7;
        let braceEnd = str.indexOf("}", braceStart);
        if (braceEnd === -1) break; 
        let envName = str.substring(braceStart, braceEnd);
        
        // Nh·ªØng m√¥i tr∆∞·ªùng N√ÄY l√† vƒÉn b·∫£n -> Kh√¥ng b·∫£o v·ªá, ƒë·ªÉ xu·ªëng d∆∞·ªõi x·ª≠ l√Ω
        if (["enumerate", "itemize", "multicols"].includes(envName)) { 
            currentIndex = braceEnd + 1; continue; 
        }

        // T√¨m tag ƒë√≥ng t∆∞∆°ng ·ª©ng
        let endTag = "\\end{" + envName + "}";
        let endIdx = str.indexOf(endTag, braceEnd);
        
        if (endIdx === -1) { currentIndex = braceEnd + 1; continue; }

        // C·∫Øt kh·ªëi n√†y ra v√† b·∫£o v·ªá (ƒë·ªÉ kh√¥ng b·ªã replace \ th√†nh <br>)
        let fullBlock = str.substring(startIdx, endIdx + endTag.length);
        let placeholder = pushBlock(fullBlock);
        str = str.substring(0, startIdx) + placeholder + str.substring(endIdx + endTag.length);
        currentIndex = startIdx + placeholder.length;
    }

    // 3. Format Text (Ch·ªâ ch·∫°y tr√™n vƒÉn b·∫£n ngo√†i Math)
    str = str.replace(/\\begin\{multicols\}\{(\d+)\}/g, "<div style='column-count: $1; column-gap: 40px;'>").replace(/\\end\{multicols\}/g, "</div>");
    str = str.replace(/\\begin\{enumerate\}(\[.*?\])?/g, "<ol style='padding-left:20px; margin: 5px 0'>").replace(/\\end\{enumerate\}/g, "</ol>");
    str = str.replace(/\\begin\{itemize\}/g, "<ul style='padding-left:20px; margin: 5px 0'>").replace(/\\end\{itemize\}/g, "</ul>");
    str = str.replace(/\\item\s*(\[.*?\])?/g, "<li>");
    
    // Chuy·ªÉn ƒë·ªïi xu·ªëng d√≤ng (Ch·ªâ t√°c ƒë·ªông text, v√¨ Math ƒë√£ b·ªã gi·∫•u)
    str = str.split("\\\\").join("<br>").split("\\newline").join("<br>");
    
    // Style
    str = str.replace(/\\textbf\{(.*?)\}/g, "<b>$1</b>").replace(/\\textit\{(.*?)\}/g, "<i>$1</i>").replace(/\\underline\{(.*?)\}/g, "<u>$1</u>");
    
    // 4. Tr·∫£ l·∫°i Math & Fix d·∫•u < >
    str = str.replace(/%%%MATH_BLOCK_(\d+)%%%/g, function(match, id) { 
        return mathBlocks[id].replace(/</g, "&lt;").replace(/>/g, "&gt;"); 
    });
    return str;
}

function extractBracedContent(text,startCommand){const startIndex=text.indexOf(startCommand);if(startIndex===-1)return{found:false,content:"",fullMatch:""};let openCount=0,contentStart=-1,foundStart=false;for(let i=startIndex;i<text.length;i++){if(text[i]==='{'){if(!foundStart){contentStart=i+1;foundStart=true}openCount++}else if(text[i]==='}'){openCount--;if(foundStart&&openCount===0)return{found:true,content:text.substring(contentStart,i),fullMatch:text.substring(startIndex,i+1)}}}return{found:false,content:"",fullMatch:""}}
function parseChoicesBlock(rawText){let choices=[],currentIndex=0;while(choices.length<4&&currentIndex<rawText.length){let openIndex=rawText.indexOf('{',currentIndex);if(openIndex===-1)break;let openCount=1,closeIndex=-1;for(let i=openIndex+1;i<rawText.length;i++){if(rawText[i]==='{')openCount++;else if(rawText[i]==='}')openCount--;if(openCount===0){closeIndex=i;break}}if(closeIndex!==-1){choices.push(rawText.substring(openIndex+1,closeIndex));currentIndex=closeIndex+1}else break}return choices}
function parseLatex(text){const questions=[],exBlocks=text.match(/\\begin\{ex\}([\s\S]*?)\\end\{ex\}/g);if(!exBlocks)return[];exBlocks.forEach(block=>{let content=block.replace(/\\begin\{ex\}|\\end\{ex\}/g,"").trim(),explain="";const loigiaiData=extractBracedContent(content,"\\loigiai");if(loigiaiData.found){explain=formatText(loigiaiData.content.trim());content=content.replace(loigiaiData.fullMatch,"")}const parts=content.split(/\\choice/);let questionText=formatText(parts[0].trim());if(parts.length<2)return;const rawChoices=parseChoicesBlock(parts[1]);if(rawChoices.length<4)return;let choices=[],correctChar='a';['a','b','c','d'].forEach((char,i)=>{let c=rawChoices[i].trim();if(c.includes("\\True")){correctChar=char;c=c.replace(/\\True/g,"").trim()}choices.push(formatText(c))});questions.push({q:questionText,a:choices[0],b:choices[1],c:choices[2],d:choices[3],correct:correctChar,explain:explain})});return questions}

function checkLogin(){ try { if(document.getElementById('password-input').value===CONFIG.pass){ document.getElementById('loading-overlay').style.display='flex'; setTimeout(() => { try { quizData=parseLatex(LATEX_CONTENT); if(quizData.length>0){ document.getElementById('login-screen').style.display='none'; document.getElementById('loading-overlay').style.display='none'; document.getElementById('main-app').style.display='flex'; initNavGrid(); loadQuestion(0); startTimer(); } else { throw new Error("Kh√¥ng t√¨m th·∫•y c√¢u h·ªèi"); } } catch(e) { document.getElementById('loading-overlay').style.display='none'; alert("L·ªói: "+e.message); } }, 500); } else { document.getElementById('login-error').style.display='block'; } } catch(e) { alert(e); } }
function startTimer(){updateTimerDisplay();timerInterval=setInterval(()=>{timeRemaining--;updateTimerDisplay();if(timeRemaining<=0){clearInterval(timerInterval);alert("H·∫øt gi·ªù!");finishQuiz(true)}},1000)}
function updateTimerDisplay(){const m=Math.floor(timeRemaining/60).toString().padStart(2,'0'),s=(timeRemaining%60).toString().padStart(2,'0');document.getElementById('timer').innerText=m+":"+s}
function initNavGrid(){const grid=document.getElementById('nav-grid');grid.innerHTML='';quizData.forEach((_,idx)=>{const btn=document.createElement('div');btn.className='q-btn';btn.innerText=idx+1;btn.id='nav-'+idx;btn.onclick=()=>loadQuestion(idx);grid.appendChild(btn)})}
function loadQuestion(index){currentQIndex=index;const data=quizData[index];document.querySelectorAll('.q-btn').forEach(b=>b.classList.remove('active'));document.getElementById('nav-'+index).classList.add('active');document.getElementById('q-number').innerText="C√¢u "+(index+1)+"/"+quizData.length;document.getElementById('q-content').innerHTML=data.q;const optionsArea=document.getElementById('options-area');optionsArea.innerHTML='';const userAnswer=userAnswers[index],showResultNow=isReviewMode||(isPracticeMode&&userAnswer);['a','b','c','d'].forEach(key=>{const label=document.createElement('label');label.className='option-label';if(showResultNow){label.style.pointerEvents='none';if(data.correct===key)label.classList.add('is-correct');if(userAnswer===key&&key!==data.correct)label.classList.add('is-wrong')}else{label.onclick=()=>selectOption(key)}if(!showResultNow&&userAnswer===key)label.classList.add('selected');label.innerHTML='<input type="radio" name="opt" '+(userAnswer===key?'checked':'')+'> <div style="width:100%">'+data[key]+'</div>';optionsArea.appendChild(label)});const explainBox=document.getElementById('explanation');if(showResultNow){document.getElementById('explain-text').innerHTML=data.explain||"Kh√¥ng c√≥ l·ªùi gi·∫£i.";explainBox.style.display='block'}else{explainBox.style.display='none'} if(window.MathJax)setTimeout(()=>MathJax.typesetPromise([document.getElementById('quiz-container-div')]),50);}
function selectOption(val){if(isReviewMode)return;userAnswers[currentQIndex]=val;document.getElementById('nav-'+currentQIndex).classList.add('answered');if(isPracticeMode)loadQuestion(currentQIndex);else{document.querySelectorAll('.option-label').forEach(l=>l.classList.remove('selected'));event.currentTarget.classList.add('selected');event.currentTarget.querySelector('input').checked=true}}
function togglePracticeMode(){isPracticeMode=document.getElementById('practice-mode').checked;loadQuestion(currentQIndex)}
function nextQuestion(){if(currentQIndex<quizData.length-1)loadQuestion(currentQIndex+1)}
function prevQuestion(){if(currentQIndex>0)loadQuestion(currentQIndex-1)}
function finishQuiz(force=false){if(!force&&!confirm("N·ªôp b√†i?"))return;clearInterval(timerInterval);isReviewMode=true;isPracticeMode=false;document.getElementById('practice-mode').disabled=true;let score=0;quizData.forEach((q,idx)=>{const btn=document.getElementById('nav-'+idx);btn.classList.remove('active');btn.classList.remove('answered');if(userAnswers[idx]===q.correct){score++;btn.classList.add('correct')}else{btn.classList.add('wrong')}});document.getElementById('quiz-area').style.display='none';document.getElementById('result-area').style.display='block';document.getElementById('btn-finish').style.display='none';document.getElementById('final-score').innerText=score+"/"+quizData.length}
function reviewMode(){document.getElementById('result-area').style.display='none';document.getElementById('quiz-area').style.display='block';loadQuestion(0)}
document.addEventListener('contextmenu',e=>e.preventDefault());document.onkeydown=function(e){if(e.keyCode==123||(e.ctrlKey&&e.shiftKey&&(e.keyCode=='I'.charCodeAt(0)||e.keyCode=='C'.charCodeAt(0)||e.keyCode=='J'.charCodeAt(0)))||(e.ctrlKey&&e.keyCode=='U'.charCodeAt(0)))return false};
</script>
</body>
</html>